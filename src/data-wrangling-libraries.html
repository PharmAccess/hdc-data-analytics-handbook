<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Analytics Handbook – data-wrangling-libraries</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../src/duckdb.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../src/data-wrangling-libraries.html">Datawrangling</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../logo-pharmaccess.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main">
    <a href="https://pharmaccess.org" rel="" title="https://pharmaccess.org" class="quarto-navigation-tool px-1" aria-label="https://pharmaccess.org"><i class="bi bi-globe"></i></a>
    <a href="https://www.linkedin.com/company/pharm-access-foundation/" rel="" title="LinkedIn company page" class="quarto-navigation-tool px-1" aria-label="LinkedIn company page"><i class="bi bi-linkedin"></i></a>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/synthea.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Synthea synthetic patient data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/duckdb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Create views using DuckDB</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/data-wrangling-libraries.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Datawrangling</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#split-apply-combine" id="toc-split-apply-combine" class="nav-link active" data-scroll-target="#split-apply-combine"><span class="header-section-number">1</span> Split-apply-combine</a></li>
  <li><a href="#datawrangling-languages-and-libraries" id="toc-datawrangling-languages-and-libraries" class="nav-link" data-scroll-target="#datawrangling-languages-and-libraries"><span class="header-section-number">2</span> Datawrangling languages and libraries</a></li>
  <li><a href="#overview-data-transformations-in-different-libraries" id="toc-overview-data-transformations-in-different-libraries" class="nav-link" data-scroll-target="#overview-data-transformations-in-different-libraries"><span class="header-section-number">3</span> Overview data transformations in different libraries</a></li>
  <li><a href="#example-using-the-synthea-dataset" id="toc-example-using-the-synthea-dataset" class="nav-link" data-scroll-target="#example-using-the-synthea-dataset"><span class="header-section-number">4</span> Example using the Synthea dataset</a>
  <ul class="collapse">
  <li><a href="#load-required-libraries" id="toc-load-required-libraries" class="nav-link" data-scroll-target="#load-required-libraries">load required libraries</a></li>
  <li><a href="#retrieve-data" id="toc-retrieve-data" class="nav-link" data-scroll-target="#retrieve-data">Retrieve data</a></li>
  <li><a href="#split-apply-combine-1" id="toc-split-apply-combine-1" class="nav-link" data-scroll-target="#split-apply-combine-1">Split-apply-combine</a></li>
  <li><a href="#filter" id="toc-filter" class="nav-link" data-scroll-target="#filter">Filter</a></li>
  <li><a href="#mutate" id="toc-mutate" class="nav-link" data-scroll-target="#mutate">Mutate</a></li>
  <li><a href="#order" id="toc-order" class="nav-link" data-scroll-target="#order">Order</a></li>
  <li><a href="#rename" id="toc-rename" class="nav-link" data-scroll-target="#rename">Rename</a></li>
  <li><a href="#join" id="toc-join" class="nav-link" data-scroll-target="#join">Join</a></li>
  <li><a href="#finishing-up" id="toc-finishing-up" class="nav-link" data-scroll-target="#finishing-up">Finishing up</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/PharmAccess/hdc-data-analytics-handbook/edit/main/src/data-wrangling-libraries.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/PharmAccess/hdc-data-analytics-handbook/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Datawrangling</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>In data analysis, we often repeat similar actions to get valuable information from the data. In this Chapter we describe the most common techniques applied in data analysis, and how they are performed in different programming languages and libraries.</p>
<section id="split-apply-combine" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="split-apply-combine"><span class="header-section-number">1</span> Split-apply-combine</h2>
<p>Many data analysis problems involve the application of a split-apply-combine strategy, where you break up a big problem into manageable pieces, operate on each piece independently and then put all the pieces back together. group_by is the most common function name for split-apply-combine technique.</p>
<p>These actions can be done with any library, in multiple programming languages. Based on the sample data created in <a href="../src/synthea.html">Synthea patient generator</a> and <a href="../src/duckdb.html">Create views using DuckDB</a>, we will go through some standard data analysis actions. We will show how to apply these actions in multiple libraries and languages.</p>
</section>
<section id="datawrangling-languages-and-libraries" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="datawrangling-languages-and-libraries"><span class="header-section-number">2</span> Datawrangling languages and libraries</h2>
<p>In this chapter we use the following languages and libraries:</p>
<p><strong>Pandas 2.0</strong><br>
<a href="">Pandas</a> is a popular python data wrangling library in the data science comunity. Pandas 2.0 mainly introduces improvements in performance, making it faster and more memory-efficient.</p>
<p><strong>Polars</strong><br>
Polars is very similar to pandas in terms of functionality. However, polars is based on Rust, which makes it highly performant.</p>
<p><strong>IBIS</strong><br>
Ibis is a python library which enables you to write your code in a pandas-like way, and the translates it to a lot of different backends. This enables you to change backends with only minor adjustments to your data wrangling code.</p>
<p><strong>PySpark</strong> <a href="">PySpark</a> is a python library for Apache Spark, an open source computing system. It enables you to work with large datasets, or run complex calculations.</p>
<p><strong>dplyr</strong><br>
dplyr is a widely used library in r.</p>
<p><strong>SQL - DuckDB</strong><br>
In this handbook we use DuckDB to show how to perform datawrangling with SQL. DuckDB SQL is almost the same as plane SQL but has a couple of extra functions to handle nested data and a couple of functions that help with data analysis. <a href="">DuckDB</a> is <strong>TODO</strong></p>
</section>
<section id="overview-data-transformations-in-different-libraries" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="overview-data-transformations-in-different-libraries"><span class="header-section-number">3</span> Overview data transformations in different libraries</h2>
<p>In the table below, you can find an overview of techniques that are often used in data analysis and the corresponding functions for them in the discussed libraries/languages.</p>
<table class="table">
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th>concept</th>
<th>pandas</th>
<th>Polars</th>
<th>IBIS</th>
<th>PySpark</th>
<th>dplyr</th>
<th>SQL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><em>Split</em></td>
<td>groupby()</td>
<td>group_by()</td>
<td>group_by()</td>
<td>groupBy()</td>
<td>group_by()</td>
<td>GROUP BY</td>
</tr>
<tr class="even">
<td><em>Apply</em></td>
<td>many functions</td>
<td>many functions</td>
<td>many functions</td>
<td>many functions</td>
<td>many functions</td>
<td>many functions</td>
</tr>
<tr class="odd">
<td><em>combine</em></td>
<td>join (), merge()</td>
<td>join()</td>
<td>left_join, inner_join() etc.</td>
<td>join()</td>
<td>left_join, inner_join() etc.</td>
<td>LEFT JOIN, JOIN etc.</td>
</tr>
<tr class="even">
<td><em>Filtering (row based)</em></td>
<td>loc[], query()</td>
<td>filter()</td>
<td>filter()</td>
<td>filter()</td>
<td>filter()</td>
<td>WHERE</td>
</tr>
<tr class="odd">
<td><em>Filtering (column based)</em></td>
<td>loc[], iloc[],</td>
<td>select()</td>
<td>-</td>
<td>select()</td>
<td>select()</td>
<td>SELECT</td>
</tr>
<tr class="even">
<td><em>Mutate</em></td>
<td>assign()</td>
<td>with_columns()</td>
<td>mutuate()</td>
<td>withColumn()</td>
<td>mutate()</td>
<td>ADD</td>
</tr>
<tr class="odd">
<td><em>Ordering</em></td>
<td>sort_values()</td>
<td>sort()</td>
<td>order_by()</td>
<td>orderBy()</td>
<td>arrange()</td>
<td>ORDER BY</td>
</tr>
</tbody>
</table>
</section>
<section id="example-using-the-synthea-dataset" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="example-using-the-synthea-dataset"><span class="header-section-number">4</span> Example using the Synthea dataset</h2>
<p>To demonstrate the most common data analysis techniques in the different languages and libraries, we use the data generated with the <a href="../src/synthea.html">Synthea Patient Generator</a>.</p>
<section id="load-required-libraries" class="level3">
<h3 class="anchored" data-anchor-id="load-required-libraries">load required libraries</h3>
<p>Before getting started, we need to load the required libraries.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">pandas</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">polars</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">SQL</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">IBIS</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-5" role="tab" aria-controls="tabset-1-5" aria-selected="false">pyspark</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-6" role="tab" aria-controls="tabset-1-6" aria-selected="false">dplyr</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars <span class="im">as</span> pl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> duckdb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ibis </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> duckdb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-5-tab">
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyspark</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> SparkSession</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.types <span class="im">import</span> StructType,StructField, StringType, DateType,TimestampType,IntegerType</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> functions <span class="im">as</span> F</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-6-tab">
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext rpy2.ipython</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>library(DBI)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>library(dplyr)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>library(duckdb)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>library(glue)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>library(lubridate)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>library(knitr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>
Attaching package: ‘dplyr’

The following objects are masked from ‘package:stats’:

    filter, lag

The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union


Attaching package: ‘lubridate’

The following objects are masked from ‘package:base’:

    date, intersect, setdiff, union
</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="retrieve-data" class="level3">
<h3 class="anchored" data-anchor-id="retrieve-data">Retrieve data</h3>
<p>In this section we will retrieve the data from the parquet files created in <a href="../src/duckdb.html">Creating views with DuckDB</a>.</p>
<p>First, we set the paths where the data is located</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Python</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">R</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>ROOT <span class="op">=</span> Path(<span class="st">'.'</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'src'</span> <span class="kw">in</span> <span class="bu">str</span>(ROOT.resolve()): <span class="co"># locally</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    ROOT <span class="op">=</span> <span class="st">'..'</span> <span class="op">/</span> ROOT <span class="co"># go one folder up</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>BRONZE <span class="op">=</span> ROOT <span class="op">/</span> <span class="st">'data'</span> <span class="op">/</span> <span class="st">'bronze'</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>SILVER <span class="op">=</span> ROOT <span class="op">/</span> <span class="st">'data'</span> <span class="op">/</span> <span class="st">'silver'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>library(here)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>ROOT <span class="op">&lt;-</span> here()</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the 'src' directory is in the path and adjust the ROOT if needed</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (grepl(<span class="st">"src"</span>, ROOT, fixed <span class="op">=</span> TRUE)) {</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  ROOT <span class="op">&lt;-</span> dirname(ROOT)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define BRONZE and SILVER directories</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>BRONZE <span class="op">&lt;-</span> <span class="bu">file</span>.path(ROOT, <span class="st">"data"</span>, <span class="st">"bronze"</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>SILVER <span class="op">&lt;-</span> <span class="bu">file</span>.path(ROOT, <span class="st">"data"</span>, <span class="st">"silver"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>here() starts at /home/runner/work/hdc-data-analytics-handbook/hdc-data-analytics-handbook</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Thereafter, we import the data in a dataframe</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">pandas</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">polars</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">SQL</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-4" role="tab" aria-controls="tabset-3-4" aria-selected="false">IBIS</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-5" role="tab" aria-controls="tabset-3-5" aria-selected="false">pyspark</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-6" role="tab" aria-controls="tabset-3-6" aria-selected="false">dplyr</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load data from parquet</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>df_timeline_pandas <span class="op">=</span> pd.read_parquet(<span class="ss">f"</span><span class="sc">{</span>SILVER<span class="sc">}</span><span class="ss">/parquet_export/patient_timeline.parquet"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>df_price_list_pandas <span class="op">=</span> pd.read_parquet(<span class="ss">f"</span><span class="sc">{</span>SILVER<span class="sc">}</span><span class="ss">/parquet_export/price_list.parquet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read parquet files in polars dateframe</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>df_timeline_polars <span class="op">=</span> pl.read_parquet(<span class="ss">f"</span><span class="sc">{</span>SILVER<span class="sc">}</span><span class="ss">/parquet_export/patient_timeline.parquet"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>df_price_list_polars <span class="op">=</span> pl.read_parquet(<span class="ss">f"</span><span class="sc">{</span>SILVER<span class="sc">}</span><span class="ss">/parquet_export/price_list.parquet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<p>In <a href="../src/duckdb.html">Creating views using DuckDB</a>, we already showed how to create a DuckDB database and read in parquet data in duckdb. Therefore we will connect here to the already created database with soley the patient_timeline and price_list table available.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># connect to the database</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>con_duckdb <span class="op">=</span> duckdb.<span class="ex">connect</span>()</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>con_duckdb.sql(</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"""</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="ss">    CREATE TABLE patient_timeline AS</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="ss">    SELECT *</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="ss">    FROM read_parquet('</span><span class="sc">{</span>SILVER<span class="sc">}</span><span class="ss">/parquet_export/patient_timeline.parquet');</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="ss">    """</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>con_duckdb.sql(</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"""</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="ss">    CREATE TABLE price_list AS</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="ss">    SELECT *</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="ss">    FROM read_parquet('</span><span class="sc">{</span>SILVER<span class="sc">}</span><span class="ss">/parquet_export/price_list.parquet');</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="ss">    """</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-4-tab">
<p><strong>TODO</strong> Show that this is also possible directly on parquet files</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read parquet files with ibis</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>df_timeline_IBIS <span class="op">=</span> ibis.read_parquet(<span class="ss">f'</span><span class="sc">{</span>SILVER<span class="sc">}</span><span class="ss">/parquet_export/patient_timeline.parquet'</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>df_price_list_ibis <span class="op">=</span> ibis.read_parquet(<span class="ss">f'</span><span class="sc">{</span>SILVER<span class="sc">}</span><span class="ss">/parquet_export/price_list.parquet'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-5-tab">
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create spark session</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>spark <span class="op">=</span> SparkSession.builder.appName(<span class="st">"patient_timeline_analysis"</span>).getOrCreate()</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># convert timeline to spark dataframe</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>df_timeline_spark <span class="op">=</span> spark.read.parquet(<span class="ss">f'</span><span class="sc">{</span>SILVER<span class="sc">}</span><span class="ss">/parquet_export/patient_timeline.parquet'</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># convert pricelist to spark dataframe</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>df_price_list_spark <span class="op">=</span> spark.read.parquet(<span class="ss">f'</span><span class="sc">{</span>SILVER<span class="sc">}</span><span class="ss">/parquet_export/price_list.parquet'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting default log level to "WARN".
To adjust logging level use sc.setLogLevel(newLevel). For SparkR, use setLogLevel(newLevel).
23/12/18 15:02:24 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable</code></pre>
</div>
</div>
</div>
<div id="tabset-3-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-6-tab">
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>con <span class="op">&lt;-</span> dbConnect(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  duckdb::duckdb(),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  dbdir <span class="op">=</span> glue(<span class="st">"</span><span class="sc">{SILVER}</span><span class="st">/pregnancy.duckdb"</span>),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  read_only <span class="op">=</span> TRUE</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">&lt;-</span> dbGetQuery(con, <span class="st">"SELECT * FROM patient_timeline"</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>df_price_list <span class="op">&lt;-</span> dbGetQuery(con, <span class="st">"SELECT * FROM price_list"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>In addition: Warning message:
In rapi_execute(res@stmt_lst$ref, res@arrow, res@connection@driver@bigint ==  :
  Coercing nanoseconds to a lower resolution may result in a loss of data.</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="split-apply-combine-1" class="level3">
<h3 class="anchored" data-anchor-id="split-apply-combine-1">Split-apply-combine</h3>
<p>From the patient timeline data, we want to know how many patients each organization has recorded. For this task we can use the split-apply-combine technique.</p>
<ul>
<li>we <strong>split</strong> the data in groups, where each group is a organization</li>
<li>we <strong>apply</strong> a function to count the number of patients in the group</li>
<li>we <strong>combine</strong> the data back together again</li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">pandas</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">polars</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false">SQL</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-4" role="tab" aria-controls="tabset-4-4" aria-selected="false">IBIS</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-5" role="tab" aria-controls="tabset-4-5" aria-selected="false">pyspark</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-6" role="tab" aria-controls="tabset-4-6" aria-selected="false">dplyr</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<p>In the code below, we can see that the groupby function splits the data into different groups (and later combines them again). the agg function applies an aggregation, in this case the unique count of patients in the group. There are a few more actions in this code, renaming the index to organization, and the patient_id column to # patients.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df_grouped_pandas <span class="op">=</span> df_timeline_pandas.groupby(<span class="st">"organization_name"</span>).agg(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"patient_id"</span>:pd.Series.nunique}</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>).rename(</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    columns <span class="op">=</span> {<span class="st">'patient_id'</span>:<span class="st">"# patients"</span>}</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>).rename_axis(<span class="st">'organization'</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># show first 5 records </span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>df_grouped_pandas.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"># patients</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">organization</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">4499 ACUSHNET AVENUE OPERATING COMPANY, LLC</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">A&amp;A HEALTHCARE LLC</td>
<td>9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ACCESS PRIMARY CARE INC</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ACHIEVE WELLNESS, LLC</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ACTIVATED BY WELLNESS LLC</td>
<td>5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df_grouped_polars <span class="op">=</span> (</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    df_timeline_polars</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">"organization_name"</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>        pl.n_unique(<span class="st">"patient_id"</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_grouped_polars.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (5, 2)
┌───────────────────────────────────┬────────────┐
│ organization_name                 ┆ patient_id │
│ ---                               ┆ ---        │
│ str                               ┆ u32        │
╞═══════════════════════════════════╪════════════╡
│ BAYSTATE MEDICAL CENTER           ┆ 7          │
│ ENCOMPASS HEALTH REHABILITATION … ┆ 12         │
│ CHILD &amp; FAMILY SERVICES, INC.     ┆ 3          │
│ EVERGREEN WELLNESS CENTER, LLC    ┆ 2          │
│ SPAULDING HOSPITAL FOR CONTINUIN… ┆ 10         │
└───────────────────────────────────┴────────────┘</code></pre>
</div>
</div>
<p>Polars supports both lazy and non-lazy (eager) evaluation. Lazy evaluation means that execution is deferred to the last minute, which can have significant performance advantages.</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>df_grouped_polars <span class="op">=</span> (</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    df_timeline_polars.lazy()</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">"organization_name"</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>        pl.n_unique(<span class="st">"patient_id"</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    .collect()</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_grouped_polars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (352, 2)
┌───────────────────────────────────┬────────────┐
│ organization_name                 ┆ patient_id │
│ ---                               ┆ ---        │
│ str                               ┆ u32        │
╞═══════════════════════════════════╪════════════╡
│ SUN MEDICAL CLINIC, PC            ┆ 5          │
│ COMMUNITY HEALTH CONNECTIONS      ┆ 1          │
│ ORLEANS MEDICAL CENTER, P.C.      ┆ 1          │
│ PLYMOUTH FAMILY OPTOMETRY LLC     ┆ 1          │
│ …                                 ┆ …          │
│ COMMUNITY HEALTH CENTER OF FRANK… ┆ 1          │
│ NASHOBA VALLEY MEDICAL CENTER     ┆ 9          │
│ FAMILY MEDICAL ASSOCIATES, P.C.   ┆ 2          │
│ LYNN COMMUNITY HEALTH             ┆ 4          │
└───────────────────────────────────┴────────────┘</code></pre>
</div>
</div>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="ss">create or replace table organization_grouped as (</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="ss">    select </span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="ss">        organization_name as organization,</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="ss">        count(distinct patient_id) as patient_count</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="ss">    from patient_timeline</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="ss">    group by organization_name</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="ss">) ;</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="ss">select * from organization_grouped </span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="ss">limit 5;</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>con_duckdb.sql(query).to_df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">organization</th>
<th data-quarto-table-cell-role="th">patient_count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>FOLEY FAMILY PRACTICE, P.C.</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>BEDFORD-LEXINGTON INTERNAL MEDICINE, PC</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>ARBOUR-FULLER HOSPITAL</td>
<td>13</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>PERSONAL PRIMARY CARE AND WEIGHT MANAGEMENT, LLC</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>MELROSE FAMILY OPTICIANS LLC</td>
<td>4</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="tabset-4-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-4-tab">
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>df_grouped_ibis <span class="op">=</span> df_timeline_IBIS.group_by(<span class="st">"organization_name"</span>).aggregate(df_timeline_IBIS.patient_id.nunique()).to_pandas()</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>df_grouped_ibis.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">organization_name</th>
<th data-quarto-table-cell-role="th">CountDistinct(patient_id)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>VIBRA HOSPITAL OF WESTERN MASS - CENTRAL CAMPUS</td>
<td>10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>GIFFORD STREET WELLNESS CENTER LLC</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>BOSTON MEDICAL CENTER CORPORATION-</td>
<td>29</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>EMERSON HOSPITAL</td>
<td>9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>ORLEANS MEDICAL CENTER, P.C.</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>df_grouped_ibis <span class="op">=</span> df_timeline_IBIS.group_by(<span class="st">"organization_name"</span>).aggregate(df_timeline_IBIS.patient_id.nunique())</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>ibis.show_sql(df_grouped_ibis)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>SELECT
  t0.organization_name,
  COUNT(DISTINCT t0.patient_id) AS "CountDistinct(patient_id)"
FROM _ibis_read_parquet_hcaoggcnprespppaffnnrd4nau AS t0
GROUP BY
  1</code></pre>
</div>
</div>
</div>
<div id="tabset-4-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-5-tab">
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#option 1, using buid in functions</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>df_grouped_pyspark <span class="op">=</span> df_timeline_spark.groupBy(<span class="st">'organization_name'</span>).agg(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>        F.countDistinct(<span class="st">'patient_id'</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    ).alias(<span class="st">'# patients'</span>)).orderBy(</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'# patients'</span>,ascending <span class="op">=</span> <span class="va">False</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>df_grouped_pyspark <span class="op">=</span> df_grouped_pyspark.withColumnRenamed(<span class="st">"organization_name"</span>, <span class="st">"organization"</span>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co"># option 2: using SQL </span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>df_timeline_spark.createOrReplaceTempView(<span class="st">"timeline"</span>)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>df_grouped_pyspark <span class="op">=</span> spark.sql(<span class="st">'''</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="st">Select </span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="st">    organization_name, </span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="st">    count(distinct patient_id) as nr_of_patients </span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="st">from timeline group by organization_name </span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="st">order by count(distinct patient_id) DESC</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="st">'''</span>)</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>df_grouped_pyspark.limit(<span class="dv">5</span>).show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------------+--------------+
|   organization_name|nr_of_patients|
+--------------------+--------------+
|BOSTON MEDICAL CE...|            29|
|WHITLEY WELLNESS LLC|            29|
|  TEWKSBURY HOSPITAL|            26|
|CAPE COD HOSPITAL...|            25|
|HARBOR HEALTH SER...|            23|
+--------------------+--------------+
</code></pre>
</div>
</div>
</div>
<div id="tabset-4-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-6-tab">
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>df_grouped <span class="op">&lt;-</span> df <span class="op">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  group_by(organization_name) <span class="op">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  summarise(</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    number_of_patients <span class="op">=</span> n_distinct(patient_id),</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>kable(head(df_grouped))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

|organization_name                           | number_of_patients|
|:-------------------------------------------|------------------:|
|4499 ACUSHNET AVENUE OPERATING COMPANY, LLC |                  5|
|A&amp;A HEALTHCARE LLC                          |                  9|
|ACCESS PRIMARY CARE INC                     |                  1|
|ACHIEVE WELLNESS, LLC                       |                  3|
|ACTIVATED BY WELLNESS LLC                   |                  5|
|ADVANTAGE HEALTH &amp; WELLNESS INC             |                  2|</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="filter" class="level3">
<h3 class="anchored" data-anchor-id="filter">Filter</h3>
<p>In data analysis it also frequently occurs that you are interested in only a subset of the data. For that reason we apply the filter technique. From our patients we only want to keep the well child visits.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">pandas</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">polars</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-3" role="tab" aria-controls="tabset-5-3" aria-selected="false">SQL</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-4" role="tab" aria-controls="tabset-5-4" aria-selected="false">IBIS</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-5" role="tab" aria-controls="tabset-5-5" aria-selected="false">pyspark</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-6" role="tab" aria-controls="tabset-5-6" aria-selected="false">dplyr</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># option 1</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>value <span class="op">=</span> <span class="st">'Well child visit (procedure)'</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>df_filtered_pandas <span class="op">=</span> df_timeline_pandas[df_timeline_pandas[<span class="st">'procedure_name'</span>] <span class="op">==</span> value]</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"># option 2</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>df_filtered_pandas <span class="op">=</span> df_timeline_pandas.loc[df_timeline_pandas[<span class="st">'procedure_name'</span>] <span class="op">==</span> value]</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co"># option 3</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>df_filtered_pandas <span class="op">=</span> df_filtered_pandas.query(<span class="ss">f"procedure_name == '</span><span class="sc">{</span>value<span class="sc">}</span><span class="ss">' "</span>)</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="co">#show results</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>df_filtered_pandas[[<span class="st">'patient_id'</span>,<span class="st">'start_time'</span>,<span class="st">'procedure_name'</span>]].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">patient_id</th>
<th data-quarto-table-cell-role="th">start_time</th>
<th data-quarto-table-cell-role="th">procedure_name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>fca8d2ca-7aef-2c27-3bba-3f94723012f5</td>
<td>2016-04-01T04:09:48+02:00</td>
<td>Well child visit (procedure)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>19936964-a432-d501-2cd5-fa52db6b9f41</td>
<td>2022-01-07T02:19:02+01:00</td>
<td>Well child visit (procedure)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0d016955-26db-966c-3d52-26d441bfcb97</td>
<td>2014-08-18T14:52:06+02:00</td>
<td>Well child visit (procedure)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>3a2311a7-eb30-2aae-59c0-55ae273d1581</td>
<td>2016-11-01T04:38:02+01:00</td>
<td>Well child visit (procedure)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>f9133ee8-f952-0e7d-f642-99d84fc9c6ad</td>
<td>2014-06-03T20:31:52+02:00</td>
<td>Well child visit (procedure)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df_filtered_polars <span class="op">=</span> (</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    df_timeline_polars</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"procedure_name"</span>) <span class="op">==</span> <span class="st">"Well child visit (procedure)"</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_filtered_polars.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (5, 18)
┌────────────┬────────────┬────────┬───────────┬───┬───────────┬───────────┬───────────┬───────────┐
│ patient_id ┆ social_sec ┆ prefix ┆ first_nam ┆ … ┆ end_time  ┆ Vaccine_n ┆ vaccine_c ┆ vaccine_c │
│ ---        ┆ urity_numb ┆ ---    ┆ e         ┆   ┆ ---       ┆ ame       ┆ ode       ┆ ode_syste │
│ str        ┆ er         ┆ str    ┆ ---       ┆   ┆ str       ┆ ---       ┆ ---       ┆ m         │
│            ┆ ---        ┆        ┆ str       ┆   ┆           ┆ str       ┆ str       ┆ ---       │
│            ┆ str        ┆        ┆           ┆   ┆           ┆           ┆           ┆ str       │
╞════════════╪════════════╪════════╪═══════════╪═══╪═══════════╪═══════════╪═══════════╪═══════════╡
│ fca8d2ca-7 ┆ 999-24-859 ┆ null   ┆ Marlen929 ┆ … ┆ 2016-04-0 ┆ Hep B,    ┆ 08        ┆ CVX       │
│ aef-2c27-3 ┆ 9          ┆        ┆           ┆   ┆ 1T04:24:4 ┆ adolescen ┆           ┆           │
│ bba-3f9472 ┆            ┆        ┆           ┆   ┆ 8+02:00   ┆ t or      ┆           ┆           │
│ 30…        ┆            ┆        ┆           ┆   ┆           ┆ pediatric ┆           ┆           │
│ 19936964-a ┆ 999-33-797 ┆ null   ┆ Monique14 ┆ … ┆ 2022-01-0 ┆ Hep B,    ┆ 08        ┆ CVX       │
│ 432-d501-2 ┆ 4          ┆        ┆ 8         ┆   ┆ 7T02:34:0 ┆ adolescen ┆           ┆           │
│ cd5-fa52db ┆            ┆        ┆           ┆   ┆ 2+01:00   ┆ t or      ┆           ┆           │
│ 6b…        ┆            ┆        ┆           ┆   ┆           ┆ pediatric ┆           ┆           │
│ 0d016955-2 ┆ 999-47-850 ┆ Ms.    ┆ Tracy345  ┆ … ┆ 2014-08-1 ┆ Influenza ┆ 140       ┆ CVX       │
│ 6db-966c-3 ┆ 0          ┆        ┆           ┆   ┆ 8T15:07:0 ┆ ,         ┆           ┆           │
│ d52-26d441 ┆            ┆        ┆           ┆   ┆ 6+02:00   ┆ seasonal, ┆           ┆           │
│ bf…        ┆            ┆        ┆           ┆   ┆           ┆ injectabl ┆           ┆           │
│            ┆            ┆        ┆           ┆   ┆           ┆ e,…       ┆           ┆           │
│ 3a2311a7-e ┆ 999-40-608 ┆ null   ┆ Janene3   ┆ … ┆ 2016-11-0 ┆ Hep B,    ┆ 08        ┆ CVX       │
│ b30-2aae-5 ┆ 4          ┆        ┆           ┆   ┆ 1T04:53:0 ┆ adolescen ┆           ┆           │
│ 9c0-55ae27 ┆            ┆        ┆           ┆   ┆ 2+01:00   ┆ t or      ┆           ┆           │
│ 3d…        ┆            ┆        ┆           ┆   ┆           ┆ pediatric ┆           ┆           │
│ f9133ee8-f ┆ 999-93-354 ┆ Ms.    ┆ Ozie87    ┆ … ┆ 2014-06-0 ┆ Influenza ┆ 140       ┆ CVX       │
│ 952-0e7d-f ┆ 6          ┆        ┆           ┆   ┆ 3T20:46:5 ┆ ,         ┆           ┆           │
│ 642-99d84f ┆            ┆        ┆           ┆   ┆ 2+02:00   ┆ seasonal, ┆           ┆           │
│ c9…        ┆            ┆        ┆           ┆   ┆           ┆ injectabl ┆           ┆           │
│            ┆            ┆        ┆           ┆   ┆           ┆ e,…       ┆           ┆           │
└────────────┴────────────┴────────┴───────────┴───┴───────────┴───────────┴───────────┴───────────┘</code></pre>
</div>
</div>
</div>
<div id="tabset-5-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-3-tab">
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="st">create or replace table filtered_table as (</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="st">    Select </span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="st">        * </span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="st">    from patient_timeline </span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="st">    where procedure_name = 'Well child visit (procedure)'</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="st">);</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="st">select * from filtered_table limit 5;</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>con_duckdb.sql(query).to_df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">patient_id</th>
<th data-quarto-table-cell-role="th">social_security_number</th>
<th data-quarto-table-cell-role="th">prefix</th>
<th data-quarto-table-cell-role="th">first_name</th>
<th data-quarto-table-cell-role="th">last_name</th>
<th data-quarto-table-cell-role="th">birthDate</th>
<th data-quarto-table-cell-role="th">code</th>
<th data-quarto-table-cell-role="th">system</th>
<th data-quarto-table-cell-role="th">organization_id</th>
<th data-quarto-table-cell-role="th">organization_name</th>
<th data-quarto-table-cell-role="th">practitioner_name</th>
<th data-quarto-table-cell-role="th">practitioner_id</th>
<th data-quarto-table-cell-role="th">procedure_name</th>
<th data-quarto-table-cell-role="th">start_time</th>
<th data-quarto-table-cell-role="th">end_time</th>
<th data-quarto-table-cell-role="th">Vaccine_name</th>
<th data-quarto-table-cell-role="th">vaccine_code</th>
<th data-quarto-table-cell-role="th">vaccine_code_system</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>fca8d2ca-7aef-2c27-3bba-3f94723012f5</td>
<td>999-24-8599</td>
<td>None</td>
<td>Marlen929</td>
<td>Greenholt190</td>
<td>2016-04-01</td>
<td>410620009</td>
<td>SNOMED</td>
<td>3f12ebb4-e03c-3453-88d2-4fc9682383df</td>
<td>NEW BEDFORD INTERNAL MEDICINE &amp; GERIATRICS, LLC</td>
<td>Dr. Homero668 Rolón954</td>
<td>9999962894</td>
<td>Well child visit (procedure)</td>
<td>2016-04-01T04:09:48+02:00</td>
<td>2016-04-01T04:24:48+02:00</td>
<td>Hep B, adolescent or pediatric</td>
<td>08</td>
<td>CVX</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>19936964-a432-d501-2cd5-fa52db6b9f41</td>
<td>999-33-7974</td>
<td>None</td>
<td>Monique148</td>
<td>Haley279</td>
<td>2022-01-07</td>
<td>410620009</td>
<td>SNOMED</td>
<td>c6b019eb-28ec-36f6-abf3-bcc4d1d58966</td>
<td>DUTTON FAMILY CARE ASSOCIATES LLP</td>
<td>Dr. Maren639 Aufderhar910</td>
<td>9999950790</td>
<td>Well child visit (procedure)</td>
<td>2022-01-07T02:19:02+01:00</td>
<td>2022-01-07T02:34:02+01:00</td>
<td>Hep B, adolescent or pediatric</td>
<td>08</td>
<td>CVX</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0d016955-26db-966c-3d52-26d441bfcb97</td>
<td>999-47-8500</td>
<td>Ms.</td>
<td>Tracy345</td>
<td>Smith67</td>
<td>2000-07-17</td>
<td>410620009</td>
<td>SNOMED</td>
<td>39c15c0f-5c49-311e-99d2-1fb99d80e06e</td>
<td>HARBOR HEALTH SERVICES INC</td>
<td>Dr. Salvador46 Homenick806</td>
<td>9999977496</td>
<td>Well child visit (procedure)</td>
<td>2014-08-18T14:52:06+02:00</td>
<td>2014-08-18T15:07:06+02:00</td>
<td>Influenza, seasonal, injectable, preservative ...</td>
<td>140</td>
<td>CVX</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>3a2311a7-eb30-2aae-59c0-55ae273d1581</td>
<td>999-40-6084</td>
<td>None</td>
<td>Janene3</td>
<td>Howe413</td>
<td>2016-11-01</td>
<td>410620009</td>
<td>SNOMED</td>
<td>2e8b42f8-4300-30a9-a576-d513d1021a0a</td>
<td>GREATER LOWELL FAMILY PRACTICE PC</td>
<td>Dr. Homero668 Salcedo309</td>
<td>9999959890</td>
<td>Well child visit (procedure)</td>
<td>2016-11-01T04:38:02+01:00</td>
<td>2016-11-01T04:53:02+01:00</td>
<td>Hep B, adolescent or pediatric</td>
<td>08</td>
<td>CVX</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>f9133ee8-f952-0e7d-f642-99d84fc9c6ad</td>
<td>999-93-3546</td>
<td>Ms.</td>
<td>Ozie87</td>
<td>Nitzsche158</td>
<td>1998-04-21</td>
<td>410620009</td>
<td>SNOMED</td>
<td>0e9d0119-1157-35a0-8bb5-7e0aa3041928</td>
<td>CARING HEALTH CENTER, INC</td>
<td>Dr. Kari181 Trantow673</td>
<td>9999979997</td>
<td>Well child visit (procedure)</td>
<td>2014-06-03T20:31:52+02:00</td>
<td>2014-06-03T20:46:52+02:00</td>
<td>Influenza, seasonal, injectable, preservative ...</td>
<td>140</td>
<td>CVX</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="tabset-5-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-4-tab">
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>df_filtered_ibis <span class="op">=</span> df_timeline_IBIS.<span class="bu">filter</span>(df_timeline_IBIS.procedure_name <span class="op">==</span> <span class="st">"Well child visit (procedure)"</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>df_filtered_ibis.to_pandas().head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">patient_id</th>
<th data-quarto-table-cell-role="th">social_security_number</th>
<th data-quarto-table-cell-role="th">prefix</th>
<th data-quarto-table-cell-role="th">first_name</th>
<th data-quarto-table-cell-role="th">last_name</th>
<th data-quarto-table-cell-role="th">birthDate</th>
<th data-quarto-table-cell-role="th">code</th>
<th data-quarto-table-cell-role="th">system</th>
<th data-quarto-table-cell-role="th">organization_id</th>
<th data-quarto-table-cell-role="th">organization_name</th>
<th data-quarto-table-cell-role="th">practitioner_name</th>
<th data-quarto-table-cell-role="th">practitioner_id</th>
<th data-quarto-table-cell-role="th">procedure_name</th>
<th data-quarto-table-cell-role="th">start_time</th>
<th data-quarto-table-cell-role="th">end_time</th>
<th data-quarto-table-cell-role="th">Vaccine_name</th>
<th data-quarto-table-cell-role="th">vaccine_code</th>
<th data-quarto-table-cell-role="th">vaccine_code_system</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>fca8d2ca-7aef-2c27-3bba-3f94723012f5</td>
<td>999-24-8599</td>
<td>None</td>
<td>Marlen929</td>
<td>Greenholt190</td>
<td>2016-04-01</td>
<td>410620009</td>
<td>SNOMED</td>
<td>3f12ebb4-e03c-3453-88d2-4fc9682383df</td>
<td>NEW BEDFORD INTERNAL MEDICINE &amp; GERIATRICS, LLC</td>
<td>Dr. Homero668 Rolón954</td>
<td>9999962894</td>
<td>Well child visit (procedure)</td>
<td>2016-04-01T04:09:48+02:00</td>
<td>2016-04-01T04:24:48+02:00</td>
<td>Hep B, adolescent or pediatric</td>
<td>08</td>
<td>CVX</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>19936964-a432-d501-2cd5-fa52db6b9f41</td>
<td>999-33-7974</td>
<td>None</td>
<td>Monique148</td>
<td>Haley279</td>
<td>2022-01-07</td>
<td>410620009</td>
<td>SNOMED</td>
<td>c6b019eb-28ec-36f6-abf3-bcc4d1d58966</td>
<td>DUTTON FAMILY CARE ASSOCIATES LLP</td>
<td>Dr. Maren639 Aufderhar910</td>
<td>9999950790</td>
<td>Well child visit (procedure)</td>
<td>2022-01-07T02:19:02+01:00</td>
<td>2022-01-07T02:34:02+01:00</td>
<td>Hep B, adolescent or pediatric</td>
<td>08</td>
<td>CVX</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0d016955-26db-966c-3d52-26d441bfcb97</td>
<td>999-47-8500</td>
<td>Ms.</td>
<td>Tracy345</td>
<td>Smith67</td>
<td>2000-07-17</td>
<td>410620009</td>
<td>SNOMED</td>
<td>39c15c0f-5c49-311e-99d2-1fb99d80e06e</td>
<td>HARBOR HEALTH SERVICES INC</td>
<td>Dr. Salvador46 Homenick806</td>
<td>9999977496</td>
<td>Well child visit (procedure)</td>
<td>2014-08-18T14:52:06+02:00</td>
<td>2014-08-18T15:07:06+02:00</td>
<td>Influenza, seasonal, injectable, preservative ...</td>
<td>140</td>
<td>CVX</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>3a2311a7-eb30-2aae-59c0-55ae273d1581</td>
<td>999-40-6084</td>
<td>None</td>
<td>Janene3</td>
<td>Howe413</td>
<td>2016-11-01</td>
<td>410620009</td>
<td>SNOMED</td>
<td>2e8b42f8-4300-30a9-a576-d513d1021a0a</td>
<td>GREATER LOWELL FAMILY PRACTICE PC</td>
<td>Dr. Homero668 Salcedo309</td>
<td>9999959890</td>
<td>Well child visit (procedure)</td>
<td>2016-11-01T04:38:02+01:00</td>
<td>2016-11-01T04:53:02+01:00</td>
<td>Hep B, adolescent or pediatric</td>
<td>08</td>
<td>CVX</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>f9133ee8-f952-0e7d-f642-99d84fc9c6ad</td>
<td>999-93-3546</td>
<td>Ms.</td>
<td>Ozie87</td>
<td>Nitzsche158</td>
<td>1998-04-21</td>
<td>410620009</td>
<td>SNOMED</td>
<td>0e9d0119-1157-35a0-8bb5-7e0aa3041928</td>
<td>CARING HEALTH CENTER, INC</td>
<td>Dr. Kari181 Trantow673</td>
<td>9999979997</td>
<td>Well child visit (procedure)</td>
<td>2014-06-03T20:31:52+02:00</td>
<td>2014-06-03T20:46:52+02:00</td>
<td>Influenza, seasonal, injectable, preservative ...</td>
<td>140</td>
<td>CVX</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="tabset-5-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-5-tab">
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># option 1</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>value <span class="op">=</span> <span class="st">'Well child visit (procedure)'</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>df_filtered_pyspark <span class="op">=</span> df_timeline_spark.<span class="bu">filter</span>(df_timeline_spark[<span class="st">'procedure_name'</span>]<span class="op">==</span>value)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># option 2</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>df_filtered_pyspark <span class="op">=</span> df_timeline_spark.<span class="bu">filter</span>(F.expr(<span class="ss">f"procedure_name == '</span><span class="sc">{</span>value<span class="sc">}</span><span class="ss">'"</span>))</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co"># option 3 - sql</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>df_timeline_spark.createOrReplaceTempView(<span class="st">"timeline"</span>)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>df_filtered_pyspark <span class="op">=</span> spark.sql(<span class="ss">f"Select * from timeline where procedure_name =='</span><span class="sc">{</span>value<span class="sc">}</span><span class="ss">'"</span>)</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co">#show results</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>df_filtered_pyspark[[<span class="st">'patient_id'</span>,<span class="st">'start_time'</span>,<span class="st">'procedure_name'</span>]].limit(<span class="dv">5</span>).show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------------+--------------------+--------------------+
|          patient_id|          start_time|      procedure_name|
+--------------------+--------------------+--------------------+
|fca8d2ca-7aef-2c2...|2016-04-01T04:09:...|Well child visit ...|
|19936964-a432-d50...|2022-01-07T02:19:...|Well child visit ...|
|0d016955-26db-966...|2014-08-18T14:52:...|Well child visit ...|
|3a2311a7-eb30-2aa...|2016-11-01T04:38:...|Well child visit ...|
|f9133ee8-f952-0e7...|2014-06-03T20:31:...|Well child visit ...|
+--------------------+--------------------+--------------------+
</code></pre>
</div>
</div>
</div>
<div id="tabset-5-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-6-tab">
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>df_filtered <span class="op">&lt;-</span> df <span class="op">%&gt;%</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">filter</span>(procedure_name <span class="op">==</span> <span class="st">"Well child visit (procedure)"</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>kable(head(df_filtered))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

|patient_id                           |social_security_number |prefix |first_name |last_name    |birthDate  |      code|system |organization_id                      |organization_name                               |practitioner_name          |practitioner_id |procedure_name               |start_time                |end_time                  |Vaccine_name                                       |vaccine_code |vaccine_code_system |
|:------------------------------------|:----------------------|:------|:----------|:------------|:----------|---------:|:------|:------------------------------------|:-----------------------------------------------|:--------------------------|:---------------|:----------------------------|:-------------------------|:-------------------------|:--------------------------------------------------|:------------|:-------------------|
|fca8d2ca-7aef-2c27-3bba-3f94723012f5 |999-24-8599            |NA     |Marlen929  |Greenholt190 |2016-04-01 | 410620009|SNOMED |3f12ebb4-e03c-3453-88d2-4fc9682383df |NEW BEDFORD INTERNAL MEDICINE &amp; GERIATRICS, LLC |Dr. Homero668 Rolón954     |9999962894      |Well child visit (procedure) |2016-04-01T04:09:48+02:00 |2016-04-01T04:24:48+02:00 |Hep B, adolescent or pediatric                     |08           |CVX                 |
|19936964-a432-d501-2cd5-fa52db6b9f41 |999-33-7974            |NA     |Monique148 |Haley279     |2022-01-07 | 410620009|SNOMED |c6b019eb-28ec-36f6-abf3-bcc4d1d58966 |DUTTON FAMILY CARE ASSOCIATES LLP               |Dr. Maren639 Aufderhar910  |9999950790      |Well child visit (procedure) |2022-01-07T02:19:02+01:00 |2022-01-07T02:34:02+01:00 |Hep B, adolescent or pediatric                     |08           |CVX                 |
|0d016955-26db-966c-3d52-26d441bfcb97 |999-47-8500            |Ms.    |Tracy345   |Smith67      |2000-07-17 | 410620009|SNOMED |39c15c0f-5c49-311e-99d2-1fb99d80e06e |HARBOR HEALTH SERVICES INC                      |Dr. Salvador46 Homenick806 |9999977496      |Well child visit (procedure) |2014-08-18T14:52:06+02:00 |2014-08-18T15:07:06+02:00 |Influenza, seasonal, injectable, preservative free |140          |CVX                 |
|3a2311a7-eb30-2aae-59c0-55ae273d1581 |999-40-6084            |NA     |Janene3    |Howe413      |2016-11-01 | 410620009|SNOMED |2e8b42f8-4300-30a9-a576-d513d1021a0a |GREATER LOWELL FAMILY PRACTICE PC               |Dr. Homero668 Salcedo309   |9999959890      |Well child visit (procedure) |2016-11-01T04:38:02+01:00 |2016-11-01T04:53:02+01:00 |Hep B, adolescent or pediatric                     |08           |CVX                 |
|f9133ee8-f952-0e7d-f642-99d84fc9c6ad |999-93-3546            |Ms.    |Ozie87     |Nitzsche158  |1998-04-21 | 410620009|SNOMED |0e9d0119-1157-35a0-8bb5-7e0aa3041928 |CARING HEALTH CENTER, INC                       |Dr. Kari181 Trantow673     |9999979997      |Well child visit (procedure) |2014-06-03T20:31:52+02:00 |2014-06-03T20:46:52+02:00 |Influenza, seasonal, injectable, preservative free |140          |CVX                 |
|f9133ee8-f952-0e7d-f642-99d84fc9c6ad |999-93-3546            |Ms.    |Ozie87     |Nitzsche158  |1998-04-21 | 410620009|SNOMED |0e9d0119-1157-35a0-8bb5-7e0aa3041928 |CARING HEALTH CENTER, INC                       |Dr. Kari181 Trantow673     |9999979997      |Well child visit (procedure) |2014-06-03T20:31:52+02:00 |2014-06-03T20:46:52+02:00 |meningococcal MCV4P                                |114          |CVX                 |</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>In addition: Warning message:
Database is garbage-collected, use dbDisconnect(con, shutdown=TRUE) or duckdb::duckdb_shutdown(drv) to avoid this. </code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Besides filtering data by content it is also possible to filter the columns one wishes to show</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">pandas</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">polars</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-3" role="tab" aria-controls="tabset-6-3" aria-selected="false">SQL</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-4" role="tab" aria-controls="tabset-6-4" aria-selected="false">IBIS</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-5" role="tab" aria-controls="tabset-6-5" aria-selected="false">pyspark</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-6" role="tab" aria-controls="tabset-6-6" aria-selected="false">dplyr</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>df_filtered_pandas.<span class="bu">filter</span>(items <span class="op">=</span> [<span class="st">'patient_id'</span>,<span class="st">'birthDate'</span>,<span class="st">'organization_name'</span>]).head(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">patient_id</th>
<th data-quarto-table-cell-role="th">birthDate</th>
<th data-quarto-table-cell-role="th">organization_name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>fca8d2ca-7aef-2c27-3bba-3f94723012f5</td>
<td>2016-04-01</td>
<td>NEW BEDFORD INTERNAL MEDICINE &amp; GERIATRICS, LLC</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>df_filtered_pandas[[<span class="st">'patient_id'</span>,<span class="st">'birthDate'</span>,<span class="st">'organization_name'</span>]].head(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">patient_id</th>
<th data-quarto-table-cell-role="th">birthDate</th>
<th data-quarto-table-cell-role="th">organization_name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>fca8d2ca-7aef-2c27-3bba-3f94723012f5</td>
<td>2016-04-01</td>
<td>NEW BEDFORD INTERNAL MEDICINE &amp; GERIATRICS, LLC</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>df_filtered_polars.select([</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">"patient_id"</span>), pl.col(<span class="st">"birthDate"</span>), pl.col(<span class="st">"organization_name"</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>]).head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<div><style>
.dataframe > thead > tr > th,
.dataframe > tbody > tr > td {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 3)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">patient_id</th>
<th data-quarto-table-cell-role="th">birthDate</th>
<th data-quarto-table-cell-role="th">organization_name</th>
</tr>
<tr class="odd">
<th>str</th>
<th>datetime[μs]</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"fca8d2ca-7aef-…</td>
<td>2016-04-01 00:00:00</td>
<td>"NEW BEDFORD IN…</td>
</tr>
<tr class="even">
<td>"19936964-a432-…</td>
<td>2022-01-07 00:00:00</td>
<td>"DUTTON FAMILY …</td>
</tr>
<tr class="odd">
<td>"0d016955-26db-…</td>
<td>2000-07-17 00:00:00</td>
<td>"HARBOR HEALTH …</td>
</tr>
<tr class="even">
<td>"3a2311a7-eb30-…</td>
<td>2016-11-01 00:00:00</td>
<td>"GREATER LOWELL…</td>
</tr>
<tr class="odd">
<td>"f9133ee8-f952-…</td>
<td>1998-04-21 00:00:00</td>
<td>"CARING HEALTH …</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="tabset-6-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-3-tab">
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="st">Select </span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="st">    patient_id,</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="st">    birthDate,</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="st">    organization_name</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="st">from patient_timeline limit 1</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>con_duckdb.sql(query).to_df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">patient_id</th>
<th data-quarto-table-cell-role="th">birthDate</th>
<th data-quarto-table-cell-role="th">organization_name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>4fc244f3-2c0e-4017-d64d-c2c4cd03655f</td>
<td>1965-01-07</td>
<td>HOLYOKE HEALTH CENTER INC</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="tabset-6-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-4-tab">
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>df_filtered_ibis.select(</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'patient_id'</span>,<span class="st">'birthDate'</span>,<span class="st">'organization_name'</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>).to_pandas().head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">patient_id</th>
<th data-quarto-table-cell-role="th">birthDate</th>
<th data-quarto-table-cell-role="th">organization_name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>fca8d2ca-7aef-2c27-3bba-3f94723012f5</td>
<td>2016-04-01</td>
<td>NEW BEDFORD INTERNAL MEDICINE &amp; GERIATRICS, LLC</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>19936964-a432-d501-2cd5-fa52db6b9f41</td>
<td>2022-01-07</td>
<td>DUTTON FAMILY CARE ASSOCIATES LLP</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0d016955-26db-966c-3d52-26d441bfcb97</td>
<td>2000-07-17</td>
<td>HARBOR HEALTH SERVICES INC</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>3a2311a7-eb30-2aae-59c0-55ae273d1581</td>
<td>2016-11-01</td>
<td>GREATER LOWELL FAMILY PRACTICE PC</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>f9133ee8-f952-0e7d-f642-99d84fc9c6ad</td>
<td>1998-04-21</td>
<td>CARING HEALTH CENTER, INC</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="tabset-6-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-5-tab">
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>df_filtered_pyspark.select(<span class="st">'patient_id'</span>,<span class="st">'birthDate'</span>,<span class="st">'organization_name'</span>).limit(<span class="dv">1</span>).show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------------+-------------------+--------------------+
|          patient_id|          birthDate|   organization_name|
+--------------------+-------------------+--------------------+
|fca8d2ca-7aef-2c2...|2016-04-01 00:00:00|NEW BEDFORD INTER...|
+--------------------+-------------------+--------------------+
</code></pre>
</div>
</div>
</div>
<div id="tabset-6-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-6-tab">
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">#TODO</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="mutate" class="level3">
<h3 class="anchored" data-anchor-id="mutate">Mutate</h3>
<p>Another common action, is that you want create adapt data. For example, we want to create another column with the year that a visit occured in the patient timeline, based on the start_time that is available. We see that currently the date is in a specific timezone, you need to take this into account when converting it in a datatime format. For now we keep the date in the same timezone, before extracting the year from it.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">pandas</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">polars</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-3" role="tab" aria-controls="tabset-7-3" aria-selected="false">SQL</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-4" role="tab" aria-controls="tabset-7-4" aria-selected="false">IBIS</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-5" role="tab" aria-controls="tabset-7-5" aria-selected="false">pyspark</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-6" role="tab" aria-controls="tabset-7-6" aria-selected="false">dplyr</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># transform start_time to datetime (its currently string format)</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>df_timeline_pandas[<span class="st">'start_time'</span>] <span class="op">=</span> pd.to_datetime(df_timeline_pandas[<span class="st">'start_time'</span>], utc<span class="op">=</span>  <span class="va">True</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>df_timeline_pandas[<span class="st">'start_time'</span>].dtype</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="co">#option 1</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>df_timeline_pandas[<span class="st">'year'</span>] <span class="op">=</span> df_timeline_pandas[<span class="st">'start_time'</span>].dt.year</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="co">#option 2</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>df_timeline_pandas <span class="op">=</span> df_timeline_pandas.assign(year<span class="op">=</span>df_timeline_pandas[<span class="st">'start_time'</span>].dt.year )</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>df_timeline_pandas[[<span class="st">'start_time'</span>,<span class="st">'year'</span>]].head(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">start_time</th>
<th data-quarto-table-cell-role="th">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2015-01-08 06:11:47+00:00</td>
<td>2015</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>df_new_var_polars <span class="op">=</span> (</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    df_timeline_polars</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"start_time"</span>).<span class="bu">str</span>.to_datetime(<span class="bu">format</span><span class="op">=</span><span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">T%H:%M:%S%z"</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>        .dt.year().alias(<span class="st">"start_year"</span>)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_new_var_polars.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (5, 19)
┌────────────┬────────────┬────────┬───────────┬───┬───────────┬───────────┬───────────┬───────────┐
│ patient_id ┆ social_sec ┆ prefix ┆ first_nam ┆ … ┆ Vaccine_n ┆ vaccine_c ┆ vaccine_c ┆ start_yea │
│ ---        ┆ urity_numb ┆ ---    ┆ e         ┆   ┆ ame       ┆ ode       ┆ ode_syste ┆ r         │
│ str        ┆ er         ┆ str    ┆ ---       ┆   ┆ ---       ┆ ---       ┆ m         ┆ ---       │
│            ┆ ---        ┆        ┆ str       ┆   ┆ str       ┆ str       ┆ ---       ┆ i32       │
│            ┆ str        ┆        ┆           ┆   ┆           ┆           ┆ str       ┆           │
╞════════════╪════════════╪════════╪═══════════╪═══╪═══════════╪═══════════╪═══════════╪═══════════╡
│ 4fc244f3-2 ┆ 999-53-581 ┆ Mrs.   ┆ Alyce744  ┆ … ┆ zoster    ┆ 121       ┆ CVX       ┆ 2015      │
│ c0e-4017-d ┆ 3          ┆        ┆           ┆   ┆ vaccine,  ┆           ┆           ┆           │
│ 64d-c2c4cd ┆            ┆        ┆           ┆   ┆ live      ┆           ┆           ┆           │
│ 03…        ┆            ┆        ┆           ┆   ┆           ┆           ┆           ┆           │
│ 4fc244f3-2 ┆ 999-53-581 ┆ Mrs.   ┆ Alyce744  ┆ … ┆ Influenza ┆ 140       ┆ CVX       ┆ 2015      │
│ c0e-4017-d ┆ 3          ┆        ┆           ┆   ┆ ,         ┆           ┆           ┆           │
│ 64d-c2c4cd ┆            ┆        ┆           ┆   ┆ seasonal, ┆           ┆           ┆           │
│ 03…        ┆            ┆        ┆           ┆   ┆ injectabl ┆           ┆           ┆           │
│            ┆            ┆        ┆           ┆   ┆ e,…       ┆           ┆           ┆           │
│ fca8d2ca-7 ┆ 999-24-859 ┆ null   ┆ Marlen929 ┆ … ┆ Hep B,    ┆ 08        ┆ CVX       ┆ 2016      │
│ aef-2c27-3 ┆ 9          ┆        ┆           ┆   ┆ adolescen ┆           ┆           ┆           │
│ bba-3f9472 ┆            ┆        ┆           ┆   ┆ t or      ┆           ┆           ┆           │
│ 30…        ┆            ┆        ┆           ┆   ┆ pediatric ┆           ┆           ┆           │
│ 19936964-a ┆ 999-33-797 ┆ null   ┆ Monique14 ┆ … ┆ Hep B,    ┆ 08        ┆ CVX       ┆ 2022      │
│ 432-d501-2 ┆ 4          ┆        ┆ 8         ┆   ┆ adolescen ┆           ┆           ┆           │
│ cd5-fa52db ┆            ┆        ┆           ┆   ┆ t or      ┆           ┆           ┆           │
│ 6b…        ┆            ┆        ┆           ┆   ┆ pediatric ┆           ┆           ┆           │
│ 0d016955-2 ┆ 999-47-850 ┆ Ms.    ┆ Tracy345  ┆ … ┆ Influenza ┆ 140       ┆ CVX       ┆ 2014      │
│ 6db-966c-3 ┆ 0          ┆        ┆           ┆   ┆ ,         ┆           ┆           ┆           │
│ d52-26d441 ┆            ┆        ┆           ┆   ┆ seasonal, ┆           ┆           ┆           │
│ bf…        ┆            ┆        ┆           ┆   ┆ injectabl ┆           ┆           ┆           │
│            ┆            ┆        ┆           ┆   ┆ e,…       ┆           ┆           ┆           │
└────────────┴────────────┴────────┴───────────┴───┴───────────┴───────────┴───────────┴───────────┘</code></pre>
</div>
</div>
</div>
<div id="tabset-7-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-3-tab">
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="st">Select</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="st">    cast(start_time as datetime) as start_time,</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="st">    year(cast(start_time as datetime)) as year</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="st">from patient_timeline;</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>con_duckdb.sql(query).to_df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">start_time</th>
<th data-quarto-table-cell-role="th">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2015-01-08 06:11:47</td>
<td>2015</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2015-01-08 06:11:47</td>
<td>2015</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2016-04-01 02:09:48</td>
<td>2016</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2022-01-07 01:19:02</td>
<td>2022</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2014-08-18 12:52:06</td>
<td>2014</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13832</td>
<td>2019-07-24 02:17:26</td>
<td>2019</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13833</td>
<td>2020-07-29 02:17:26</td>
<td>2020</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13834</td>
<td>2021-08-04 02:17:26</td>
<td>2021</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13835</td>
<td>2022-08-10 02:17:26</td>
<td>2022</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13836</td>
<td>2023-08-16 02:17:26</td>
<td>2023</td>
</tr>
</tbody>
</table>

<p>13837 rows × 2 columns</p>
</div>
</div>
</div>
</div>
<div id="tabset-7-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-4-tab">
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>df_new_var_ibis <span class="op">=</span> df_timeline_IBIS.mutate(start_year<span class="op">=</span>df_timeline_IBIS.start_time.cast(<span class="st">"timestamp"</span>).year()).to_pandas()</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>df_new_var_ibis.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">patient_id</th>
<th data-quarto-table-cell-role="th">social_security_number</th>
<th data-quarto-table-cell-role="th">prefix</th>
<th data-quarto-table-cell-role="th">first_name</th>
<th data-quarto-table-cell-role="th">last_name</th>
<th data-quarto-table-cell-role="th">birthDate</th>
<th data-quarto-table-cell-role="th">code</th>
<th data-quarto-table-cell-role="th">system</th>
<th data-quarto-table-cell-role="th">organization_id</th>
<th data-quarto-table-cell-role="th">organization_name</th>
<th data-quarto-table-cell-role="th">practitioner_name</th>
<th data-quarto-table-cell-role="th">practitioner_id</th>
<th data-quarto-table-cell-role="th">procedure_name</th>
<th data-quarto-table-cell-role="th">start_time</th>
<th data-quarto-table-cell-role="th">end_time</th>
<th data-quarto-table-cell-role="th">Vaccine_name</th>
<th data-quarto-table-cell-role="th">vaccine_code</th>
<th data-quarto-table-cell-role="th">vaccine_code_system</th>
<th data-quarto-table-cell-role="th">start_year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>4fc244f3-2c0e-4017-d64d-c2c4cd03655f</td>
<td>999-53-5813</td>
<td>Mrs.</td>
<td>Alyce744</td>
<td>Bergstrom287</td>
<td>1965-01-07</td>
<td>162673000</td>
<td>SNOMED</td>
<td>b03b624d-c939-3688-986d-9555b8009a3b</td>
<td>HOLYOKE HEALTH CENTER INC</td>
<td>Dr. Bennett146 Hartmann983</td>
<td>9999981894</td>
<td>General examination of patient (procedure)</td>
<td>2015-01-08T07:11:47+01:00</td>
<td>2015-01-08T07:26:47+01:00</td>
<td>zoster vaccine, live</td>
<td>121</td>
<td>CVX</td>
<td>2015</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>4fc244f3-2c0e-4017-d64d-c2c4cd03655f</td>
<td>999-53-5813</td>
<td>Mrs.</td>
<td>Alyce744</td>
<td>Bergstrom287</td>
<td>1965-01-07</td>
<td>162673000</td>
<td>SNOMED</td>
<td>b03b624d-c939-3688-986d-9555b8009a3b</td>
<td>HOLYOKE HEALTH CENTER INC</td>
<td>Dr. Bennett146 Hartmann983</td>
<td>9999981894</td>
<td>General examination of patient (procedure)</td>
<td>2015-01-08T07:11:47+01:00</td>
<td>2015-01-08T07:26:47+01:00</td>
<td>Influenza, seasonal, injectable, preservative ...</td>
<td>140</td>
<td>CVX</td>
<td>2015</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>fca8d2ca-7aef-2c27-3bba-3f94723012f5</td>
<td>999-24-8599</td>
<td>None</td>
<td>Marlen929</td>
<td>Greenholt190</td>
<td>2016-04-01</td>
<td>410620009</td>
<td>SNOMED</td>
<td>3f12ebb4-e03c-3453-88d2-4fc9682383df</td>
<td>NEW BEDFORD INTERNAL MEDICINE &amp; GERIATRICS, LLC</td>
<td>Dr. Homero668 Rolón954</td>
<td>9999962894</td>
<td>Well child visit (procedure)</td>
<td>2016-04-01T04:09:48+02:00</td>
<td>2016-04-01T04:24:48+02:00</td>
<td>Hep B, adolescent or pediatric</td>
<td>08</td>
<td>CVX</td>
<td>2016</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>19936964-a432-d501-2cd5-fa52db6b9f41</td>
<td>999-33-7974</td>
<td>None</td>
<td>Monique148</td>
<td>Haley279</td>
<td>2022-01-07</td>
<td>410620009</td>
<td>SNOMED</td>
<td>c6b019eb-28ec-36f6-abf3-bcc4d1d58966</td>
<td>DUTTON FAMILY CARE ASSOCIATES LLP</td>
<td>Dr. Maren639 Aufderhar910</td>
<td>9999950790</td>
<td>Well child visit (procedure)</td>
<td>2022-01-07T02:19:02+01:00</td>
<td>2022-01-07T02:34:02+01:00</td>
<td>Hep B, adolescent or pediatric</td>
<td>08</td>
<td>CVX</td>
<td>2022</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0d016955-26db-966c-3d52-26d441bfcb97</td>
<td>999-47-8500</td>
<td>Ms.</td>
<td>Tracy345</td>
<td>Smith67</td>
<td>2000-07-17</td>
<td>410620009</td>
<td>SNOMED</td>
<td>39c15c0f-5c49-311e-99d2-1fb99d80e06e</td>
<td>HARBOR HEALTH SERVICES INC</td>
<td>Dr. Salvador46 Homenick806</td>
<td>9999977496</td>
<td>Well child visit (procedure)</td>
<td>2014-08-18T14:52:06+02:00</td>
<td>2014-08-18T15:07:06+02:00</td>
<td>Influenza, seasonal, injectable, preservative ...</td>
<td>140</td>
<td>CVX</td>
<td>2014</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="tabset-7-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-5-tab">
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># transform start_time to datetime (its currently string format)</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>df_timeline_spark <span class="op">=</span> df_timeline_spark.withColumn(<span class="st">"start_time"</span>, F.to_utc_timestamp(df_timeline_spark[<span class="st">"start_time"</span>], <span class="st">"Europe/Amsterdam"</span>))</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>df_timeline_spark <span class="op">=</span> df_timeline_spark.withColumn(<span class="st">"year"</span>, F.year(df_timeline_spark[<span class="st">"start_time"</span>]))</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>df_timeline_spark.select(<span class="st">'start_time'</span>,<span class="st">'year'</span>).limit(<span class="dv">3</span>).show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+-------------------+----+
|         start_time|year|
+-------------------+----+
|2015-01-08 05:11:47|2015|
|2015-01-08 05:11:47|2015|
|2016-04-01 00:09:48|2016|
+-------------------+----+
</code></pre>
</div>
</div>
</div>
<div id="tabset-7-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-6-tab">
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>df_new_var <span class="op">&lt;-</span> df <span class="op">%&gt;%</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  mutate(start_year <span class="op">=</span> year(<span class="im">as</span>.Date(start_time, <span class="bu">format</span> <span class="op">=</span> <span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">"</span>)))</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>kable(head(df_new_var))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

|patient_id                           |social_security_number |prefix |first_name |last_name    |birthDate  |      code|system |organization_id                      |organization_name                               |practitioner_name          |practitioner_id |procedure_name                             |start_time                |end_time                  |Vaccine_name                                       |vaccine_code |vaccine_code_system | start_year|
|:------------------------------------|:----------------------|:------|:----------|:------------|:----------|---------:|:------|:------------------------------------|:-----------------------------------------------|:--------------------------|:---------------|:------------------------------------------|:-------------------------|:-------------------------|:--------------------------------------------------|:------------|:-------------------|----------:|
|4fc244f3-2c0e-4017-d64d-c2c4cd03655f |999-53-5813            |Mrs.   |Alyce744   |Bergstrom287 |1965-01-07 | 162673000|SNOMED |b03b624d-c939-3688-986d-9555b8009a3b |HOLYOKE HEALTH CENTER INC                       |Dr. Bennett146 Hartmann983 |9999981894      |General examination of patient (procedure) |2015-01-08T07:11:47+01:00 |2015-01-08T07:26:47+01:00 |zoster vaccine, live                               |121          |CVX                 |       2015|
|4fc244f3-2c0e-4017-d64d-c2c4cd03655f |999-53-5813            |Mrs.   |Alyce744   |Bergstrom287 |1965-01-07 | 162673000|SNOMED |b03b624d-c939-3688-986d-9555b8009a3b |HOLYOKE HEALTH CENTER INC                       |Dr. Bennett146 Hartmann983 |9999981894      |General examination of patient (procedure) |2015-01-08T07:11:47+01:00 |2015-01-08T07:26:47+01:00 |Influenza, seasonal, injectable, preservative free |140          |CVX                 |       2015|
|fca8d2ca-7aef-2c27-3bba-3f94723012f5 |999-24-8599            |NA     |Marlen929  |Greenholt190 |2016-04-01 | 410620009|SNOMED |3f12ebb4-e03c-3453-88d2-4fc9682383df |NEW BEDFORD INTERNAL MEDICINE &amp; GERIATRICS, LLC |Dr. Homero668 Rolón954     |9999962894      |Well child visit (procedure)               |2016-04-01T04:09:48+02:00 |2016-04-01T04:24:48+02:00 |Hep B, adolescent or pediatric                     |08           |CVX                 |       2016|
|19936964-a432-d501-2cd5-fa52db6b9f41 |999-33-7974            |NA     |Monique148 |Haley279     |2022-01-07 | 410620009|SNOMED |c6b019eb-28ec-36f6-abf3-bcc4d1d58966 |DUTTON FAMILY CARE ASSOCIATES LLP               |Dr. Maren639 Aufderhar910  |9999950790      |Well child visit (procedure)               |2022-01-07T02:19:02+01:00 |2022-01-07T02:34:02+01:00 |Hep B, adolescent or pediatric                     |08           |CVX                 |       2022|
|0d016955-26db-966c-3d52-26d441bfcb97 |999-47-8500            |Ms.    |Tracy345   |Smith67      |2000-07-17 | 410620009|SNOMED |39c15c0f-5c49-311e-99d2-1fb99d80e06e |HARBOR HEALTH SERVICES INC                      |Dr. Salvador46 Homenick806 |9999977496      |Well child visit (procedure)               |2014-08-18T14:52:06+02:00 |2014-08-18T15:07:06+02:00 |Influenza, seasonal, injectable, preservative free |140          |CVX                 |       2014|
|3a2311a7-eb30-2aae-59c0-55ae273d1581 |999-40-6084            |NA     |Janene3    |Howe413      |2016-11-01 | 410620009|SNOMED |2e8b42f8-4300-30a9-a576-d513d1021a0a |GREATER LOWELL FAMILY PRACTICE PC               |Dr. Homero668 Salcedo309   |9999959890      |Well child visit (procedure)               |2016-11-01T04:38:02+01:00 |2016-11-01T04:53:02+01:00 |Hep B, adolescent or pediatric                     |08           |CVX                 |       2016|</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="order" class="level3">
<h3 class="anchored" data-anchor-id="order">Order</h3>
<p>It often occurs that you want to order your data. In this case let’s order the patient timeline by start_time. Most libraries automatically order in an ascending/asc order: oldest first, and alow you to order descending/desc (newest first).</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">pandas</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">polars</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-3" role="tab" aria-controls="tabset-8-3" aria-selected="false">SQL</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-4" role="tab" aria-controls="tabset-8-4" aria-selected="false">IBIS</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-5" role="tab" aria-controls="tabset-8-5" aria-selected="false">pyspark</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-6" role="tab" aria-controls="tabset-8-6" aria-selected="false">dplyr</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>df_ordered_pandas <span class="op">=</span> df_timeline_pandas.sort_values(by <span class="op">=</span> <span class="st">'start_time'</span>, ascending <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>df_ordered_pandas[[<span class="st">'patient_id'</span>,<span class="st">'start_time'</span>,<span class="st">'procedure_name'</span>]].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">patient_id</th>
<th data-quarto-table-cell-role="th">start_time</th>
<th data-quarto-table-cell-role="th">procedure_name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1871</td>
<td>1d24c422-98a8-713d-3184-fbd05c3695a1</td>
<td>2023-09-05 10:06:14+00:00</td>
<td>Well child visit (procedure)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1872</td>
<td>1d24c422-98a8-713d-3184-fbd05c3695a1</td>
<td>2023-09-05 10:06:14+00:00</td>
<td>Well child visit (procedure)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9916</td>
<td>404e3ebd-a1e3-4678-7d4e-58a48ca21418</td>
<td>2023-09-05 03:32:07+00:00</td>
<td>Well child visit (procedure)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5872</td>
<td>4efaa926-30cf-0fcd-04d9-0d31c4071483</td>
<td>2023-09-04 04:12:02+00:00</td>
<td>General examination of patient (procedure)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12301</td>
<td>8f262a31-6268-5a96-7432-1723d168687f</td>
<td>2023-09-04 01:54:17+00:00</td>
<td>General examination of patient (procedure)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>df_ordered_polars <span class="op">=</span> (</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>    df_timeline_polars</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"start_time"</span>).<span class="bu">str</span>.to_datetime(<span class="bu">format</span><span class="op">=</span><span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">T%H:%M:%S%z"</span>)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    .sort(<span class="st">"start_time"</span>)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_ordered_polars.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (5, 18)
┌────────────┬────────────┬────────┬───────────┬───┬───────────┬───────────┬───────────┬───────────┐
│ patient_id ┆ social_sec ┆ prefix ┆ first_nam ┆ … ┆ end_time  ┆ Vaccine_n ┆ vaccine_c ┆ vaccine_c │
│ ---        ┆ urity_numb ┆ ---    ┆ e         ┆   ┆ ---       ┆ ame       ┆ ode       ┆ ode_syste │
│ str        ┆ er         ┆ str    ┆ ---       ┆   ┆ str       ┆ ---       ┆ ---       ┆ m         │
│            ┆ ---        ┆        ┆ str       ┆   ┆           ┆ str       ┆ str       ┆ ---       │
│            ┆ str        ┆        ┆           ┆   ┆           ┆           ┆           ┆ str       │
╞════════════╪════════════╪════════╪═══════════╪═══╪═══════════╪═══════════╪═══════════╪═══════════╡
│ 9808a732-1 ┆ 999-90-152 ┆ Mrs.   ┆ Pattie91  ┆ … ┆ 2013-09-1 ┆ Influenza ┆ 140       ┆ CVX       │
│ f51-6483-d ┆ 4          ┆        ┆           ┆   ┆ 1T19:23:1 ┆ ,         ┆           ┆           │
│ 8b0-ec0d61 ┆            ┆        ┆           ┆   ┆ 4+02:00   ┆ seasonal, ┆           ┆           │
│ f8…        ┆            ┆        ┆           ┆   ┆           ┆ injectabl ┆           ┆           │
│            ┆            ┆        ┆           ┆   ┆           ┆ e,…       ┆           ┆           │
│ 6f93e13d-d ┆ 999-65-407 ┆ Mrs.   ┆ Carrie738 ┆ … ┆ 2013-09-1 ┆ Influenza ┆ 140       ┆ CVX       │
│ 237-acc2-4 ┆ 9          ┆        ┆           ┆   ┆ 1T21:06:5 ┆ ,         ┆           ┆           │
│ 7f0-d1fa20 ┆            ┆        ┆           ┆   ┆ 0+02:00   ┆ seasonal, ┆           ┆           │
│ c6…        ┆            ┆        ┆           ┆   ┆           ┆ injectabl ┆           ┆           │
│            ┆            ┆        ┆           ┆   ┆           ┆ e,…       ┆           ┆           │
│ 7aafabc2-f ┆ 999-49-954 ┆ null   ┆ Maximina9 ┆ … ┆ 2013-09-1 ┆ Hep B,    ┆ 08        ┆ CVX       │
│ 4cf-3d82-f ┆ 2          ┆        ┆ 16        ┆   ┆ 2T05:05:4 ┆ adolescen ┆           ┆           │
│ 1e9-64d809 ┆            ┆        ┆           ┆   ┆ 5+02:00   ┆ t or      ┆           ┆           │
│ 4b…        ┆            ┆        ┆           ┆   ┆           ┆ pediatric ┆           ┆           │
│ 1c2f968a-4 ┆ 999-61-837 ┆ null   ┆ Claribel7 ┆ … ┆ 2013-09-1 ┆ varicella ┆ 21        ┆ CVX       │
│ 735-c752-0 ┆ 5          ┆        ┆ 06        ┆   ┆ 3T02:11:3 ┆           ┆           ┆           │
│ 7dd-54a664 ┆            ┆        ┆           ┆   ┆ 5+02:00   ┆           ┆           ┆           │
│ fe…        ┆            ┆        ┆           ┆   ┆           ┆           ┆           ┆           │
│ 1c2f968a-4 ┆ 999-61-837 ┆ null   ┆ Claribel7 ┆ … ┆ 2013-09-1 ┆ IPV       ┆ 10        ┆ CVX       │
│ 735-c752-0 ┆ 5          ┆        ┆ 06        ┆   ┆ 3T02:11:3 ┆           ┆           ┆           │
│ 7dd-54a664 ┆            ┆        ┆           ┆   ┆ 5+02:00   ┆           ┆           ┆           │
│ fe…        ┆            ┆        ┆           ┆   ┆           ┆           ┆           ┆           │
└────────────┴────────────┴────────┴───────────┴───┴───────────┴───────────┴───────────┴───────────┘</code></pre>
</div>
</div>
</div>
<div id="tabset-8-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-3-tab">
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="st">Select </span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="st">    * </span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="st">from patient_timeline</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="st">order by start_time asc </span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="st">limit 5</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>con_duckdb.sql(query).to_df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">patient_id</th>
<th data-quarto-table-cell-role="th">social_security_number</th>
<th data-quarto-table-cell-role="th">prefix</th>
<th data-quarto-table-cell-role="th">first_name</th>
<th data-quarto-table-cell-role="th">last_name</th>
<th data-quarto-table-cell-role="th">birthDate</th>
<th data-quarto-table-cell-role="th">code</th>
<th data-quarto-table-cell-role="th">system</th>
<th data-quarto-table-cell-role="th">organization_id</th>
<th data-quarto-table-cell-role="th">organization_name</th>
<th data-quarto-table-cell-role="th">practitioner_name</th>
<th data-quarto-table-cell-role="th">practitioner_id</th>
<th data-quarto-table-cell-role="th">procedure_name</th>
<th data-quarto-table-cell-role="th">start_time</th>
<th data-quarto-table-cell-role="th">end_time</th>
<th data-quarto-table-cell-role="th">Vaccine_name</th>
<th data-quarto-table-cell-role="th">vaccine_code</th>
<th data-quarto-table-cell-role="th">vaccine_code_system</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>9808a732-1f51-6483-d8b0-ec0d61f8cead</td>
<td>999-90-1524</td>
<td>Mrs.</td>
<td>Pattie91</td>
<td>Abbott774</td>
<td>1967-08-23</td>
<td>162673000</td>
<td>SNOMED</td>
<td>b44955d1-f0e2-3beb-a013-708a81dbe430</td>
<td>SIGNATURE HEALTHCARE MEDICAL GROUP INC</td>
<td>Dr. Ernest565 Runte676</td>
<td>9999970699</td>
<td>General examination of patient (procedure)</td>
<td>2013-09-11T19:08:14+02:00</td>
<td>2013-09-11T19:23:14+02:00</td>
<td>Influenza, seasonal, injectable, preservative ...</td>
<td>140</td>
<td>CVX</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>6f93e13d-d237-acc2-47f0-d1fa20c62df2</td>
<td>999-65-4079</td>
<td>Mrs.</td>
<td>Carrie738</td>
<td>Blick895</td>
<td>1985-07-03</td>
<td>162673000</td>
<td>SNOMED</td>
<td>11a40a26-a5a3-331d-aef0-d06dd90e2b4e</td>
<td>CAPE COD PRIMARY CARE LLC</td>
<td>Dr. Len277 Wintheiser220</td>
<td>9999947994</td>
<td>General examination of patient (procedure)</td>
<td>2013-09-11T20:51:50+02:00</td>
<td>2013-09-11T21:06:50+02:00</td>
<td>Influenza, seasonal, injectable, preservative ...</td>
<td>140</td>
<td>CVX</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>7aafabc2-f4cf-3d82-f1e9-64d8094beeb6</td>
<td>999-49-9542</td>
<td>None</td>
<td>Maximina916</td>
<td>Rutherford999</td>
<td>2013-09-12</td>
<td>410620009</td>
<td>SNOMED</td>
<td>dd9914b0-9491-3330-a890-d34e95e497ea</td>
<td>CHILD &amp; FAMILY SERVICES, INC.</td>
<td>Dr. Assunta351 Haley279</td>
<td>9999967794</td>
<td>Well child visit (procedure)</td>
<td>2013-09-12T04:50:45+02:00</td>
<td>2013-09-12T05:05:45+02:00</td>
<td>Hep B, adolescent or pediatric</td>
<td>08</td>
<td>CVX</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1c2f968a-4735-c752-07dd-54a664fef295</td>
<td>999-61-8375</td>
<td>None</td>
<td>Claribel706</td>
<td>Ruecker817</td>
<td>2008-10-03</td>
<td>410620009</td>
<td>SNOMED</td>
<td>542185c1-943a-30f4-aba0-0efaa92488a4</td>
<td>EVEREST HEALTH CARE SPECIALISTS PLLC</td>
<td>Dr. Luetta803 Rau926</td>
<td>9999955096</td>
<td>Well child visit (procedure)</td>
<td>2013-09-13T01:56:35+02:00</td>
<td>2013-09-13T02:11:35+02:00</td>
<td>MMR</td>
<td>03</td>
<td>CVX</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1c2f968a-4735-c752-07dd-54a664fef295</td>
<td>999-61-8375</td>
<td>None</td>
<td>Claribel706</td>
<td>Ruecker817</td>
<td>2008-10-03</td>
<td>410620009</td>
<td>SNOMED</td>
<td>542185c1-943a-30f4-aba0-0efaa92488a4</td>
<td>EVEREST HEALTH CARE SPECIALISTS PLLC</td>
<td>Dr. Luetta803 Rau926</td>
<td>9999955096</td>
<td>Well child visit (procedure)</td>
<td>2013-09-13T01:56:35+02:00</td>
<td>2013-09-13T02:11:35+02:00</td>
<td>DTaP</td>
<td>20</td>
<td>CVX</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="tabset-8-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-4-tab">
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>df_ordered_ibis <span class="op">=</span> df_timeline_IBIS.order_by(df_timeline_IBIS.start_time.cast(<span class="st">"timestamp"</span>)).to_pandas()</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>df_ordered_ibis.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">patient_id</th>
<th data-quarto-table-cell-role="th">social_security_number</th>
<th data-quarto-table-cell-role="th">prefix</th>
<th data-quarto-table-cell-role="th">first_name</th>
<th data-quarto-table-cell-role="th">last_name</th>
<th data-quarto-table-cell-role="th">birthDate</th>
<th data-quarto-table-cell-role="th">code</th>
<th data-quarto-table-cell-role="th">system</th>
<th data-quarto-table-cell-role="th">organization_id</th>
<th data-quarto-table-cell-role="th">organization_name</th>
<th data-quarto-table-cell-role="th">practitioner_name</th>
<th data-quarto-table-cell-role="th">practitioner_id</th>
<th data-quarto-table-cell-role="th">procedure_name</th>
<th data-quarto-table-cell-role="th">start_time</th>
<th data-quarto-table-cell-role="th">end_time</th>
<th data-quarto-table-cell-role="th">Vaccine_name</th>
<th data-quarto-table-cell-role="th">vaccine_code</th>
<th data-quarto-table-cell-role="th">vaccine_code_system</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>9808a732-1f51-6483-d8b0-ec0d61f8cead</td>
<td>999-90-1524</td>
<td>Mrs.</td>
<td>Pattie91</td>
<td>Abbott774</td>
<td>1967-08-23</td>
<td>162673000</td>
<td>SNOMED</td>
<td>b44955d1-f0e2-3beb-a013-708a81dbe430</td>
<td>SIGNATURE HEALTHCARE MEDICAL GROUP INC</td>
<td>Dr. Ernest565 Runte676</td>
<td>9999970699</td>
<td>General examination of patient (procedure)</td>
<td>2013-09-11T19:08:14+02:00</td>
<td>2013-09-11T19:23:14+02:00</td>
<td>Influenza, seasonal, injectable, preservative ...</td>
<td>140</td>
<td>CVX</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>6f93e13d-d237-acc2-47f0-d1fa20c62df2</td>
<td>999-65-4079</td>
<td>Mrs.</td>
<td>Carrie738</td>
<td>Blick895</td>
<td>1985-07-03</td>
<td>162673000</td>
<td>SNOMED</td>
<td>11a40a26-a5a3-331d-aef0-d06dd90e2b4e</td>
<td>CAPE COD PRIMARY CARE LLC</td>
<td>Dr. Len277 Wintheiser220</td>
<td>9999947994</td>
<td>General examination of patient (procedure)</td>
<td>2013-09-11T20:51:50+02:00</td>
<td>2013-09-11T21:06:50+02:00</td>
<td>Influenza, seasonal, injectable, preservative ...</td>
<td>140</td>
<td>CVX</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>7aafabc2-f4cf-3d82-f1e9-64d8094beeb6</td>
<td>999-49-9542</td>
<td>None</td>
<td>Maximina916</td>
<td>Rutherford999</td>
<td>2013-09-12</td>
<td>410620009</td>
<td>SNOMED</td>
<td>dd9914b0-9491-3330-a890-d34e95e497ea</td>
<td>CHILD &amp; FAMILY SERVICES, INC.</td>
<td>Dr. Assunta351 Haley279</td>
<td>9999967794</td>
<td>Well child visit (procedure)</td>
<td>2013-09-12T04:50:45+02:00</td>
<td>2013-09-12T05:05:45+02:00</td>
<td>Hep B, adolescent or pediatric</td>
<td>08</td>
<td>CVX</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1c2f968a-4735-c752-07dd-54a664fef295</td>
<td>999-61-8375</td>
<td>None</td>
<td>Claribel706</td>
<td>Ruecker817</td>
<td>2008-10-03</td>
<td>410620009</td>
<td>SNOMED</td>
<td>542185c1-943a-30f4-aba0-0efaa92488a4</td>
<td>EVEREST HEALTH CARE SPECIALISTS PLLC</td>
<td>Dr. Luetta803 Rau926</td>
<td>9999955096</td>
<td>Well child visit (procedure)</td>
<td>2013-09-13T01:56:35+02:00</td>
<td>2013-09-13T02:11:35+02:00</td>
<td>varicella</td>
<td>21</td>
<td>CVX</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1c2f968a-4735-c752-07dd-54a664fef295</td>
<td>999-61-8375</td>
<td>None</td>
<td>Claribel706</td>
<td>Ruecker817</td>
<td>2008-10-03</td>
<td>410620009</td>
<td>SNOMED</td>
<td>542185c1-943a-30f4-aba0-0efaa92488a4</td>
<td>EVEREST HEALTH CARE SPECIALISTS PLLC</td>
<td>Dr. Luetta803 Rau926</td>
<td>9999955096</td>
<td>Well child visit (procedure)</td>
<td>2013-09-13T01:56:35+02:00</td>
<td>2013-09-13T02:11:35+02:00</td>
<td>IPV</td>
<td>10</td>
<td>CVX</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="tabset-8-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-5-tab">
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>df_ordered_pyspark <span class="op">=</span> df_timeline_spark.orderBy(<span class="st">'start_time'</span>,ascending <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>df_ordered_pyspark.limit(<span class="dv">5</span>).show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------------+----------------------+------+-----------+--------------+-------------------+---------+------+--------------------+--------------------+--------------------+---------------+--------------------+-------------------+--------------------+--------------------+------------+-------------------+----+
|          patient_id|social_security_number|prefix| first_name|     last_name|          birthDate|     code|system|     organization_id|   organization_name|   practitioner_name|practitioner_id|      procedure_name|         start_time|            end_time|        Vaccine_name|vaccine_code|vaccine_code_system|year|
+--------------------+----------------------+------+-----------+--------------+-------------------+---------+------+--------------------+--------------------+--------------------+---------------+--------------------+-------------------+--------------------+--------------------+------------+-------------------+----+
|1d24c422-98a8-713...|           999-29-9635|  NULL|  Taneka590|       Howe413|2011-08-16 00:00:00|410620009|SNOMED|545dcda5-7471-374...|COMMUNITY HEALTH ...|Dr. Lezlie553 Kos...|     9999981191|Well child visit ...|2023-09-05 08:06:14|2023-09-05T12:21:...|   HPV, quadrivalent|          62|                CVX|2023|
|1d24c422-98a8-713...|           999-29-9635|  NULL|  Taneka590|       Howe413|2011-08-16 00:00:00|410620009|SNOMED|545dcda5-7471-374...|COMMUNITY HEALTH ...|Dr. Lezlie553 Kos...|     9999981191|Well child visit ...|2023-09-05 08:06:14|2023-09-05T12:21:...|Influenza, season...|         140|                CVX|2023|
|404e3ebd-a1e3-467...|           999-54-8765|  NULL|Nicholle822|      Runte676|2013-08-27 00:00:00|410620009|SNOMED|84abfbd5-41c1-3df...|SKIN WELLNESS PHY...|Dr. Cole117 Block661|     9999953190|Well child visit ...|2023-09-05 01:32:07|2023-09-05T05:47:...|Influenza, season...|         140|                CVX|2023|
|4efaa926-30cf-0fc...|           999-66-1148|  Mrs.|    Lisa683|Schamberger479|1951-04-30 00:00:00|162673000|SNOMED|0583e4f7-f1c2-310...|COMMUNITY HEALTH ...| Dr. Jewel43 Howe413|     9999978494|General examinati...|2023-09-04 02:12:02|2023-09-04T06:27:...|Influenza, season...|         140|                CVX|2023|
|8f262a31-6268-5a9...|           999-13-3109|  Mrs.|      Pa577|     Graham902|1970-08-17 00:00:00|162673000|SNOMED|e1892a2c-6dca-3c4...|PRIMARY &amp; PREVENT...|Dr. Derek111 Erdm...|     9999954990|General examinati...|2023-09-03 23:54:17|2023-09-04T04:09:...|Influenza, season...|         140|                CVX|2023|
+--------------------+----------------------+------+-----------+--------------+-------------------+---------+------+--------------------+--------------------+--------------------+---------------+--------------------+-------------------+--------------------+--------------------+------------+-------------------+----+
</code></pre>
</div>
</div>
</div>
<div id="tabset-8-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-6-tab">
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>df_ordered <span class="op">&lt;-</span> df <span class="op">%&gt;%</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  mutate(start_time <span class="op">=</span> <span class="im">as</span>.Date(start_time), <span class="bu">format</span> <span class="op">=</span> <span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">"</span>) <span class="op">%&gt;%</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  arrange(start_time)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>kable(head(df_ordered))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

|patient_id                           |social_security_number |prefix |first_name  |last_name     |birthDate  |      code|system |organization_id                      |organization_name                             |practitioner_name        |practitioner_id |procedure_name                             |start_time |end_time                  |Vaccine_name                                       |vaccine_code |vaccine_code_system |format   |
|:------------------------------------|:----------------------|:------|:-----------|:-------------|:----------|---------:|:------|:------------------------------------|:---------------------------------------------|:------------------------|:---------------|:------------------------------------------|:----------|:-------------------------|:--------------------------------------------------|:------------|:-------------------|:--------|
|6f93e13d-d237-acc2-47f0-d1fa20c62df2 |999-65-4079            |Mrs.   |Carrie738   |Blick895      |1985-07-03 | 162673000|SNOMED |11a40a26-a5a3-331d-aef0-d06dd90e2b4e |CAPE COD PRIMARY CARE LLC                     |Dr. Len277 Wintheiser220 |9999947994      |General examination of patient (procedure) |2013-09-11 |2013-09-11T21:06:50+02:00 |Influenza, seasonal, injectable, preservative free |140          |CVX                 |%Y-%m-%d |
|9808a732-1f51-6483-d8b0-ec0d61f8cead |999-90-1524            |Mrs.   |Pattie91    |Abbott774     |1967-08-23 | 162673000|SNOMED |b44955d1-f0e2-3beb-a013-708a81dbe430 |SIGNATURE HEALTHCARE MEDICAL GROUP INC        |Dr. Ernest565 Runte676   |9999970699      |General examination of patient (procedure) |2013-09-11 |2013-09-11T19:23:14+02:00 |Influenza, seasonal, injectable, preservative free |140          |CVX                 |%Y-%m-%d |
|7aafabc2-f4cf-3d82-f1e9-64d8094beeb6 |999-49-9542            |NA     |Maximina916 |Rutherford999 |2013-09-12 | 410620009|SNOMED |dd9914b0-9491-3330-a890-d34e95e497ea |CHILD &amp; FAMILY SERVICES, INC.                 |Dr. Assunta351 Haley279  |9999967794      |Well child visit (procedure)               |2013-09-12 |2013-09-12T05:05:45+02:00 |Hep B, adolescent or pediatric                     |08           |CVX                 |%Y-%m-%d |
|0a78537c-628d-77a4-d16b-ec23b6327c9e |999-89-9767            |NA     |Kalyn451    |Smith67       |2007-09-28 | 410620009|SNOMED |7a75decf-7d3f-3b0d-8c2b-3abf0a8c7f58 |NEW ENGLAND PROFESSIONAL HOME HEALTH CARE LLC |Dr. Afton574 Kulas532    |9999944595      |Well child visit (procedure)               |2013-09-13 |2013-09-13T06:33:22+02:00 |Influenza, seasonal, injectable, preservative free |140          |CVX                 |%Y-%m-%d |
|1c2f968a-4735-c752-07dd-54a664fef295 |999-61-8375            |NA     |Claribel706 |Ruecker817    |2008-10-03 | 410620009|SNOMED |542185c1-943a-30f4-aba0-0efaa92488a4 |EVEREST HEALTH CARE SPECIALISTS PLLC          |Dr. Luetta803 Rau926     |9999955096      |Well child visit (procedure)               |2013-09-13 |2013-09-13T02:11:35+02:00 |varicella                                          |21           |CVX                 |%Y-%m-%d |
|1c2f968a-4735-c752-07dd-54a664fef295 |999-61-8375            |NA     |Claribel706 |Ruecker817    |2008-10-03 | 410620009|SNOMED |542185c1-943a-30f4-aba0-0efaa92488a4 |EVEREST HEALTH CARE SPECIALISTS PLLC          |Dr. Luetta803 Rau926     |9999955096      |Well child visit (procedure)               |2013-09-13 |2013-09-13T02:11:35+02:00 |IPV                                                |10           |CVX                 |%Y-%m-%d |</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="rename" class="level3">
<h3 class="anchored" data-anchor-id="rename">Rename</h3>
<p>Another action that is done frequently is the renaming of a column. As an example we rename the birthDate column to birth_date</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">pandas</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">polars</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-3" role="tab" aria-controls="tabset-9-3" aria-selected="false">SQL</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-4" role="tab" aria-controls="tabset-9-4" aria-selected="false">IBIS</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-5" role="tab" aria-controls="tabset-9-5" aria-selected="false">pyspark</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-6" role="tab" aria-controls="tabset-9-6" aria-selected="false">dplyr</a></li></ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<p>In pandas, many actions such as <em>rename</em> can be adapted directly in the same dataframe by adding the option inplace = True.</p>
<p>Alternatively, one can create a new dataframe and keep the name the same in the original dataframe.</p>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co">#option 1 - change in dataframe</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>df_timeline_pandas.rename(columns <span class="op">=</span> {<span class="st">'birthDate'</span>:<span class="st">'birth_date'</span>}, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co">#option 2 - change only in new dataframe</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>df_renamed_pandas <span class="op">=</span> df_timeline_pandas.rename(columns <span class="op">=</span> {<span class="st">'birthDate'</span>:<span class="st">'birth_date'</span>})</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>df_renamed_pandas.head(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">patient_id</th>
<th data-quarto-table-cell-role="th">social_security_number</th>
<th data-quarto-table-cell-role="th">prefix</th>
<th data-quarto-table-cell-role="th">first_name</th>
<th data-quarto-table-cell-role="th">last_name</th>
<th data-quarto-table-cell-role="th">birth_date</th>
<th data-quarto-table-cell-role="th">code</th>
<th data-quarto-table-cell-role="th">system</th>
<th data-quarto-table-cell-role="th">organization_id</th>
<th data-quarto-table-cell-role="th">organization_name</th>
<th data-quarto-table-cell-role="th">practitioner_name</th>
<th data-quarto-table-cell-role="th">practitioner_id</th>
<th data-quarto-table-cell-role="th">procedure_name</th>
<th data-quarto-table-cell-role="th">start_time</th>
<th data-quarto-table-cell-role="th">end_time</th>
<th data-quarto-table-cell-role="th">Vaccine_name</th>
<th data-quarto-table-cell-role="th">vaccine_code</th>
<th data-quarto-table-cell-role="th">vaccine_code_system</th>
<th data-quarto-table-cell-role="th">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>4fc244f3-2c0e-4017-d64d-c2c4cd03655f</td>
<td>999-53-5813</td>
<td>Mrs.</td>
<td>Alyce744</td>
<td>Bergstrom287</td>
<td>1965-01-07</td>
<td>162673000</td>
<td>SNOMED</td>
<td>b03b624d-c939-3688-986d-9555b8009a3b</td>
<td>HOLYOKE HEALTH CENTER INC</td>
<td>Dr. Bennett146 Hartmann983</td>
<td>9999981894</td>
<td>General examination of patient (procedure)</td>
<td>2015-01-08 06:11:47+00:00</td>
<td>2015-01-08T07:26:47+01:00</td>
<td>zoster vaccine, live</td>
<td>121</td>
<td>CVX</td>
<td>2015</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>df_renamed_polars <span class="op">=</span> (</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>    df_timeline_polars</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>    .rename({<span class="st">"birthDate"</span>: <span class="st">"birth_date"</span>})</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_renamed_polars.head(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (1, 18)
┌────────────┬────────────┬────────┬───────────┬───┬───────────┬───────────┬───────────┬───────────┐
│ patient_id ┆ social_sec ┆ prefix ┆ first_nam ┆ … ┆ end_time  ┆ Vaccine_n ┆ vaccine_c ┆ vaccine_c │
│ ---        ┆ urity_numb ┆ ---    ┆ e         ┆   ┆ ---       ┆ ame       ┆ ode       ┆ ode_syste │
│ str        ┆ er         ┆ str    ┆ ---       ┆   ┆ str       ┆ ---       ┆ ---       ┆ m         │
│            ┆ ---        ┆        ┆ str       ┆   ┆           ┆ str       ┆ str       ┆ ---       │
│            ┆ str        ┆        ┆           ┆   ┆           ┆           ┆           ┆ str       │
╞════════════╪════════════╪════════╪═══════════╪═══╪═══════════╪═══════════╪═══════════╪═══════════╡
│ 4fc244f3-2 ┆ 999-53-581 ┆ Mrs.   ┆ Alyce744  ┆ … ┆ 2015-01-0 ┆ zoster    ┆ 121       ┆ CVX       │
│ c0e-4017-d ┆ 3          ┆        ┆           ┆   ┆ 8T07:26:4 ┆ vaccine,  ┆           ┆           │
│ 64d-c2c4cd ┆            ┆        ┆           ┆   ┆ 7+01:00   ┆ live      ┆           ┆           │
│ 03…        ┆            ┆        ┆           ┆   ┆           ┆           ┆           ┆           │
└────────────┴────────────┴────────┴───────────┴───┴───────────┴───────────┴───────────┴───────────┘</code></pre>
</div>
</div>
</div>
<div id="tabset-9-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-3-tab">
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="st">alter table patient_timeline</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="st">rename column birthDate to birth_date;</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="st">select * from patient_timeline limit 5;</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(con_duckdb.sql(query).to_df())</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>con_duckdb.sql(<span class="st">"alter table patient_timeline rename column birth_date to birthDate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                             patient_id social_security_number prefix   
0  4fc244f3-2c0e-4017-d64d-c2c4cd03655f            999-53-5813   Mrs.  \
1  4fc244f3-2c0e-4017-d64d-c2c4cd03655f            999-53-5813   Mrs.   
2  fca8d2ca-7aef-2c27-3bba-3f94723012f5            999-24-8599   None   
3  19936964-a432-d501-2cd5-fa52db6b9f41            999-33-7974   None   
4  0d016955-26db-966c-3d52-26d441bfcb97            999-47-8500    Ms.   

   first_name     last_name birth_date       code  system   
0    Alyce744  Bergstrom287 1965-01-07  162673000  SNOMED  \
1    Alyce744  Bergstrom287 1965-01-07  162673000  SNOMED   
2   Marlen929  Greenholt190 2016-04-01  410620009  SNOMED   
3  Monique148      Haley279 2022-01-07  410620009  SNOMED   
4    Tracy345       Smith67 2000-07-17  410620009  SNOMED   

                        organization_id   
0  b03b624d-c939-3688-986d-9555b8009a3b  \
1  b03b624d-c939-3688-986d-9555b8009a3b   
2  3f12ebb4-e03c-3453-88d2-4fc9682383df   
3  c6b019eb-28ec-36f6-abf3-bcc4d1d58966   
4  39c15c0f-5c49-311e-99d2-1fb99d80e06e   

                                 organization_name   
0                        HOLYOKE HEALTH CENTER INC  \
1                        HOLYOKE HEALTH CENTER INC   
2  NEW BEDFORD INTERNAL MEDICINE &amp; GERIATRICS, LLC   
3                DUTTON FAMILY CARE ASSOCIATES LLP   
4                       HARBOR HEALTH SERVICES INC   

            practitioner_name practitioner_id   
0  Dr. Bennett146 Hartmann983      9999981894  \
1  Dr. Bennett146 Hartmann983      9999981894   
2      Dr. Homero668 Rolón954      9999962894   
3   Dr. Maren639 Aufderhar910      9999950790   
4  Dr. Salvador46 Homenick806      9999977496   

                               procedure_name                 start_time   
0  General examination of patient (procedure)  2015-01-08T07:11:47+01:00  \
1  General examination of patient (procedure)  2015-01-08T07:11:47+01:00   
2                Well child visit (procedure)  2016-04-01T04:09:48+02:00   
3                Well child visit (procedure)  2022-01-07T02:19:02+01:00   
4                Well child visit (procedure)  2014-08-18T14:52:06+02:00   

                    end_time   
0  2015-01-08T07:26:47+01:00  \
1  2015-01-08T07:26:47+01:00   
2  2016-04-01T04:24:48+02:00   
3  2022-01-07T02:34:02+01:00   
4  2014-08-18T15:07:06+02:00   

                                        Vaccine_name vaccine_code   
0                               zoster vaccine, live          121  \
1  Influenza, seasonal, injectable, preservative ...          140   
2                     Hep B, adolescent or pediatric           08   
3                     Hep B, adolescent or pediatric           08   
4  Influenza, seasonal, injectable, preservative ...          140   

  vaccine_code_system  
0                 CVX  
1                 CVX  
2                 CVX  
3                 CVX  
4                 CVX  </code></pre>
</div>
</div>
</div>
<div id="tabset-9-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-4-tab">
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>df_renamed_ibis <span class="op">=</span> df_timeline_IBIS.relabel({<span class="st">"birthDate"</span>: <span class="st">"birth_date"</span>}).to_pandas()</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>df_renamed_ibis.head(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">patient_id</th>
<th data-quarto-table-cell-role="th">social_security_number</th>
<th data-quarto-table-cell-role="th">prefix</th>
<th data-quarto-table-cell-role="th">first_name</th>
<th data-quarto-table-cell-role="th">last_name</th>
<th data-quarto-table-cell-role="th">birth_date</th>
<th data-quarto-table-cell-role="th">code</th>
<th data-quarto-table-cell-role="th">system</th>
<th data-quarto-table-cell-role="th">organization_id</th>
<th data-quarto-table-cell-role="th">organization_name</th>
<th data-quarto-table-cell-role="th">practitioner_name</th>
<th data-quarto-table-cell-role="th">practitioner_id</th>
<th data-quarto-table-cell-role="th">procedure_name</th>
<th data-quarto-table-cell-role="th">start_time</th>
<th data-quarto-table-cell-role="th">end_time</th>
<th data-quarto-table-cell-role="th">Vaccine_name</th>
<th data-quarto-table-cell-role="th">vaccine_code</th>
<th data-quarto-table-cell-role="th">vaccine_code_system</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>4fc244f3-2c0e-4017-d64d-c2c4cd03655f</td>
<td>999-53-5813</td>
<td>Mrs.</td>
<td>Alyce744</td>
<td>Bergstrom287</td>
<td>1965-01-07</td>
<td>162673000</td>
<td>SNOMED</td>
<td>b03b624d-c939-3688-986d-9555b8009a3b</td>
<td>HOLYOKE HEALTH CENTER INC</td>
<td>Dr. Bennett146 Hartmann983</td>
<td>9999981894</td>
<td>General examination of patient (procedure)</td>
<td>2015-01-08T07:11:47+01:00</td>
<td>2015-01-08T07:26:47+01:00</td>
<td>zoster vaccine, live</td>
<td>121</td>
<td>CVX</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="tabset-9-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-5-tab">
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>df_renamed_pyspark <span class="op">=</span> df_timeline_spark.withColumnRenamed(<span class="st">"birthDate"</span>, <span class="st">"birth_date"</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>df_renamed_pyspark.head(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>[Row(patient_id='4fc244f3-2c0e-4017-d64d-c2c4cd03655f', social_security_number='999-53-5813', prefix='Mrs.', first_name='Alyce744', last_name='Bergstrom287', birth_date=datetime.datetime(1965, 1, 7, 0, 0), code=162673000, system='SNOMED', organization_id='b03b624d-c939-3688-986d-9555b8009a3b', organization_name='HOLYOKE HEALTH CENTER INC', practitioner_name='Dr. Bennett146 Hartmann983', practitioner_id='9999981894', procedure_name='General examination of patient (procedure)', start_time=datetime.datetime(2015, 1, 8, 5, 11, 47), end_time='2015-01-08T07:26:47+01:00', Vaccine_name='zoster vaccine, live', vaccine_code='121', vaccine_code_system='CVX', year=2015)]</code></pre>
</div>
</div>
</div>
<div id="tabset-9-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-6-tab">
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>df_renamed <span class="op">&lt;-</span> df <span class="op">%&gt;%</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  rename(birth_date <span class="op">=</span> birthDate)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>kable(head(df_renamed))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

|patient_id                           |social_security_number |prefix |first_name |last_name    |birth_date |      code|system |organization_id                      |organization_name                               |practitioner_name          |practitioner_id |procedure_name                             |start_time                |end_time                  |Vaccine_name                                       |vaccine_code |vaccine_code_system |
|:------------------------------------|:----------------------|:------|:----------|:------------|:----------|---------:|:------|:------------------------------------|:-----------------------------------------------|:--------------------------|:---------------|:------------------------------------------|:-------------------------|:-------------------------|:--------------------------------------------------|:------------|:-------------------|
|4fc244f3-2c0e-4017-d64d-c2c4cd03655f |999-53-5813            |Mrs.   |Alyce744   |Bergstrom287 |1965-01-07 | 162673000|SNOMED |b03b624d-c939-3688-986d-9555b8009a3b |HOLYOKE HEALTH CENTER INC                       |Dr. Bennett146 Hartmann983 |9999981894      |General examination of patient (procedure) |2015-01-08T07:11:47+01:00 |2015-01-08T07:26:47+01:00 |zoster vaccine, live                               |121          |CVX                 |
|4fc244f3-2c0e-4017-d64d-c2c4cd03655f |999-53-5813            |Mrs.   |Alyce744   |Bergstrom287 |1965-01-07 | 162673000|SNOMED |b03b624d-c939-3688-986d-9555b8009a3b |HOLYOKE HEALTH CENTER INC                       |Dr. Bennett146 Hartmann983 |9999981894      |General examination of patient (procedure) |2015-01-08T07:11:47+01:00 |2015-01-08T07:26:47+01:00 |Influenza, seasonal, injectable, preservative free |140          |CVX                 |
|fca8d2ca-7aef-2c27-3bba-3f94723012f5 |999-24-8599            |NA     |Marlen929  |Greenholt190 |2016-04-01 | 410620009|SNOMED |3f12ebb4-e03c-3453-88d2-4fc9682383df |NEW BEDFORD INTERNAL MEDICINE &amp; GERIATRICS, LLC |Dr. Homero668 Rolón954     |9999962894      |Well child visit (procedure)               |2016-04-01T04:09:48+02:00 |2016-04-01T04:24:48+02:00 |Hep B, adolescent or pediatric                     |08           |CVX                 |
|19936964-a432-d501-2cd5-fa52db6b9f41 |999-33-7974            |NA     |Monique148 |Haley279     |2022-01-07 | 410620009|SNOMED |c6b019eb-28ec-36f6-abf3-bcc4d1d58966 |DUTTON FAMILY CARE ASSOCIATES LLP               |Dr. Maren639 Aufderhar910  |9999950790      |Well child visit (procedure)               |2022-01-07T02:19:02+01:00 |2022-01-07T02:34:02+01:00 |Hep B, adolescent or pediatric                     |08           |CVX                 |
|0d016955-26db-966c-3d52-26d441bfcb97 |999-47-8500            |Ms.    |Tracy345   |Smith67      |2000-07-17 | 410620009|SNOMED |39c15c0f-5c49-311e-99d2-1fb99d80e06e |HARBOR HEALTH SERVICES INC                      |Dr. Salvador46 Homenick806 |9999977496      |Well child visit (procedure)               |2014-08-18T14:52:06+02:00 |2014-08-18T15:07:06+02:00 |Influenza, seasonal, injectable, preservative free |140          |CVX                 |
|3a2311a7-eb30-2aae-59c0-55ae273d1581 |999-40-6084            |NA     |Janene3    |Howe413      |2016-11-01 | 410620009|SNOMED |2e8b42f8-4300-30a9-a576-d513d1021a0a |GREATER LOWELL FAMILY PRACTICE PC               |Dr. Homero668 Salcedo309   |9999959890      |Well child visit (procedure)               |2016-11-01T04:38:02+01:00 |2016-11-01T04:53:02+01:00 |Hep B, adolescent or pediatric                     |08           |CVX                 |</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="join" class="level3">
<h3 class="anchored" data-anchor-id="join">Join</h3>
<p>It’s rare that a data analysis involves only a single data frame. Typically you have many data frames, and you must join them together to answer the questions that you’re interested in.</p>
<p>An inner join keeps observations that appear in both tables.</p>
<div id="inner-join" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/join-inner.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">inner join</figcaption>
</figure>
</div>
<p>An outer join keeps observations that appear in at least one of the tables. There are three types of outer joins:</p>
<ul>
<li>A left join keeps all observations in x.</li>
<li>A right join keeps all observations in y.</li>
<li>A full join keeps all observations in x and y.</li>
</ul>
<div id="outer-join" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/join-outer.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">outer join</figcaption>
</figure>
</div>
<p>The most commonly used join is the left join: you use this whenever you look up additional data from another table, because it preserves the original observations even when there isn’t a match. The left join should be your default join: use it unless you have a strong reason to prefer one of the others.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">pandas</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">polars</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-3" role="tab" aria-controls="tabset-10-3" aria-selected="false">SQL</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-4" role="tab" aria-controls="tabset-10-4" aria-selected="false">IBIS</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-5" role="tab" aria-controls="tabset-10-5" aria-selected="false">pyspark</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-6" role="tab" aria-controls="tabset-10-6" aria-selected="false">dplyr</a></li></ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>df_joined_pandas <span class="op">=</span> pd.merge(</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>    df_timeline_pandas,</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>    df_price_list_pandas, </span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>    left_on <span class="op">=</span> [<span class="st">'vaccine_code'</span>,<span class="st">'vaccine_code_system'</span>], </span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>    right_on <span class="op">=</span> [<span class="st">'code'</span>,<span class="st">'system'</span>], </span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>    how <span class="op">=</span><span class="st">'left'</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>df_joined_pandas.<span class="bu">filter</span>(items <span class="op">=</span> [<span class="st">'patient_id'</span>,<span class="st">'start_time'</span>,<span class="st">'year'</span>,<span class="st">'vaccine_name'</span>,<span class="st">'item_claimed'</span>,<span class="st">'USD'</span>]).head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">patient_id</th>
<th data-quarto-table-cell-role="th">start_time</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">item_claimed</th>
<th data-quarto-table-cell-role="th">USD</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>4fc244f3-2c0e-4017-d64d-c2c4cd03655f</td>
<td>2015-01-08 06:11:47+00:00</td>
<td>2015</td>
<td>zoster vaccine, live</td>
<td>136.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>4fc244f3-2c0e-4017-d64d-c2c4cd03655f</td>
<td>2015-01-08 06:11:47+00:00</td>
<td>2015</td>
<td>Influenza, seasonal, injectable, preservative ...</td>
<td>136.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>fca8d2ca-7aef-2c27-3bba-3f94723012f5</td>
<td>2016-04-01 02:09:48+00:00</td>
<td>2016</td>
<td>Hep B, adolescent or pediatric</td>
<td>136.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>19936964-a432-d501-2cd5-fa52db6b9f41</td>
<td>2022-01-07 01:19:02+00:00</td>
<td>2022</td>
<td>Hep B, adolescent or pediatric</td>
<td>136.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0d016955-26db-966c-3d52-26d441bfcb97</td>
<td>2014-08-18 12:52:06+00:00</td>
<td>2014</td>
<td>Influenza, seasonal, injectable, preservative ...</td>
<td>136.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>df_joined_polars <span class="op">=</span> (</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>    df_timeline_polars</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    .join(</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>        df_price_list_polars,</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>        left_on<span class="op">=</span>[<span class="st">"vaccine_code"</span>, <span class="st">"vaccine_code_system"</span>],</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>        right_on<span class="op">=</span>[<span class="st">"code"</span>, <span class="st">"system"</span>],</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>        how<span class="op">=</span><span class="st">"left"</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_joined_polars.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (5, 20)
┌────────────┬────────────┬────────┬────────────┬───┬────────────┬────────────┬────────────┬───────┐
│ patient_id ┆ social_sec ┆ prefix ┆ first_name ┆ … ┆ vaccine_co ┆ vaccine_co ┆ item_claim ┆ USD   │
│ ---        ┆ urity_numb ┆ ---    ┆ ---        ┆   ┆ de         ┆ de_system  ┆ ed         ┆ ---   │
│ str        ┆ er         ┆ str    ┆ str        ┆   ┆ ---        ┆ ---        ┆ ---        ┆ f64   │
│            ┆ ---        ┆        ┆            ┆   ┆ str        ┆ str        ┆ str        ┆       │
│            ┆ str        ┆        ┆            ┆   ┆            ┆            ┆            ┆       │
╞════════════╪════════════╪════════╪════════════╪═══╪════════════╪════════════╪════════════╪═══════╡
│ 4fc244f3-2 ┆ 999-53-581 ┆ Mrs.   ┆ Alyce744   ┆ … ┆ 121        ┆ CVX        ┆ zoster     ┆ 136.0 │
│ c0e-4017-d ┆ 3          ┆        ┆            ┆   ┆            ┆            ┆ vaccine,   ┆       │
│ 64d-c2c4cd ┆            ┆        ┆            ┆   ┆            ┆            ┆ live       ┆       │
│ 03…        ┆            ┆        ┆            ┆   ┆            ┆            ┆            ┆       │
│ 4fc244f3-2 ┆ 999-53-581 ┆ Mrs.   ┆ Alyce744   ┆ … ┆ 140        ┆ CVX        ┆ Influenza, ┆ 136.0 │
│ c0e-4017-d ┆ 3          ┆        ┆            ┆   ┆            ┆            ┆ seasonal,  ┆       │
│ 64d-c2c4cd ┆            ┆        ┆            ┆   ┆            ┆            ┆ injectable ┆       │
│ 03…        ┆            ┆        ┆            ┆   ┆            ┆            ┆ ,…         ┆       │
│ fca8d2ca-7 ┆ 999-24-859 ┆ null   ┆ Marlen929  ┆ … ┆ 08         ┆ CVX        ┆ Hep B,     ┆ 136.0 │
│ aef-2c27-3 ┆ 9          ┆        ┆            ┆   ┆            ┆            ┆ adolescent ┆       │
│ bba-3f9472 ┆            ┆        ┆            ┆   ┆            ┆            ┆ or         ┆       │
│ 30…        ┆            ┆        ┆            ┆   ┆            ┆            ┆ pediatric  ┆       │
│ 19936964-a ┆ 999-33-797 ┆ null   ┆ Monique148 ┆ … ┆ 08         ┆ CVX        ┆ Hep B,     ┆ 136.0 │
│ 432-d501-2 ┆ 4          ┆        ┆            ┆   ┆            ┆            ┆ adolescent ┆       │
│ cd5-fa52db ┆            ┆        ┆            ┆   ┆            ┆            ┆ or         ┆       │
│ 6b…        ┆            ┆        ┆            ┆   ┆            ┆            ┆ pediatric  ┆       │
│ 0d016955-2 ┆ 999-47-850 ┆ Ms.    ┆ Tracy345   ┆ … ┆ 140        ┆ CVX        ┆ Influenza, ┆ 136.0 │
│ 6db-966c-3 ┆ 0          ┆        ┆            ┆   ┆            ┆            ┆ seasonal,  ┆       │
│ d52-26d441 ┆            ┆        ┆            ┆   ┆            ┆            ┆ injectable ┆       │
│ bf…        ┆            ┆        ┆            ┆   ┆            ┆            ┆ ,…         ┆       │
└────────────┴────────────┴────────┴────────────┴───┴────────────┴────────────┴────────────┴───────┘</code></pre>
</div>
</div>
</div>
<div id="tabset-10-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-3-tab">
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="st">Select </span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="st">* </span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="st">from patient_timeline pt</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="st">left join price_list pl on pt.vaccine_code = pl.code and pt.vaccine_code_system = pl.system</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a><span class="st">limit 5;</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>con_duckdb.sql(query).to_df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">patient_id</th>
<th data-quarto-table-cell-role="th">social_security_number</th>
<th data-quarto-table-cell-role="th">prefix</th>
<th data-quarto-table-cell-role="th">first_name</th>
<th data-quarto-table-cell-role="th">last_name</th>
<th data-quarto-table-cell-role="th">birthDate</th>
<th data-quarto-table-cell-role="th">code</th>
<th data-quarto-table-cell-role="th">system</th>
<th data-quarto-table-cell-role="th">organization_id</th>
<th data-quarto-table-cell-role="th">organization_name</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">procedure_name</th>
<th data-quarto-table-cell-role="th">start_time</th>
<th data-quarto-table-cell-role="th">end_time</th>
<th data-quarto-table-cell-role="th">Vaccine_name</th>
<th data-quarto-table-cell-role="th">vaccine_code</th>
<th data-quarto-table-cell-role="th">vaccine_code_system</th>
<th data-quarto-table-cell-role="th">code_2</th>
<th data-quarto-table-cell-role="th">system_2</th>
<th data-quarto-table-cell-role="th">item_claimed</th>
<th data-quarto-table-cell-role="th">USD</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>4fc244f3-2c0e-4017-d64d-c2c4cd03655f</td>
<td>999-53-5813</td>
<td>Mrs.</td>
<td>Alyce744</td>
<td>Bergstrom287</td>
<td>1965-01-07</td>
<td>162673000</td>
<td>SNOMED</td>
<td>b03b624d-c939-3688-986d-9555b8009a3b</td>
<td>HOLYOKE HEALTH CENTER INC</td>
<td>...</td>
<td>General examination of patient (procedure)</td>
<td>2015-01-08T07:11:47+01:00</td>
<td>2015-01-08T07:26:47+01:00</td>
<td>zoster vaccine, live</td>
<td>121</td>
<td>CVX</td>
<td>121</td>
<td>CVX</td>
<td>zoster vaccine, live</td>
<td>136.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>4fc244f3-2c0e-4017-d64d-c2c4cd03655f</td>
<td>999-53-5813</td>
<td>Mrs.</td>
<td>Alyce744</td>
<td>Bergstrom287</td>
<td>1965-01-07</td>
<td>162673000</td>
<td>SNOMED</td>
<td>b03b624d-c939-3688-986d-9555b8009a3b</td>
<td>HOLYOKE HEALTH CENTER INC</td>
<td>...</td>
<td>General examination of patient (procedure)</td>
<td>2015-01-08T07:11:47+01:00</td>
<td>2015-01-08T07:26:47+01:00</td>
<td>Influenza, seasonal, injectable, preservative ...</td>
<td>140</td>
<td>CVX</td>
<td>140</td>
<td>CVX</td>
<td>Influenza, seasonal, injectable, preservative ...</td>
<td>136.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>fca8d2ca-7aef-2c27-3bba-3f94723012f5</td>
<td>999-24-8599</td>
<td>None</td>
<td>Marlen929</td>
<td>Greenholt190</td>
<td>2016-04-01</td>
<td>410620009</td>
<td>SNOMED</td>
<td>3f12ebb4-e03c-3453-88d2-4fc9682383df</td>
<td>NEW BEDFORD INTERNAL MEDICINE &amp; GERIATRICS, LLC</td>
<td>...</td>
<td>Well child visit (procedure)</td>
<td>2016-04-01T04:09:48+02:00</td>
<td>2016-04-01T04:24:48+02:00</td>
<td>Hep B, adolescent or pediatric</td>
<td>08</td>
<td>CVX</td>
<td>08</td>
<td>CVX</td>
<td>Hep B, adolescent or pediatric</td>
<td>136.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>19936964-a432-d501-2cd5-fa52db6b9f41</td>
<td>999-33-7974</td>
<td>None</td>
<td>Monique148</td>
<td>Haley279</td>
<td>2022-01-07</td>
<td>410620009</td>
<td>SNOMED</td>
<td>c6b019eb-28ec-36f6-abf3-bcc4d1d58966</td>
<td>DUTTON FAMILY CARE ASSOCIATES LLP</td>
<td>...</td>
<td>Well child visit (procedure)</td>
<td>2022-01-07T02:19:02+01:00</td>
<td>2022-01-07T02:34:02+01:00</td>
<td>Hep B, adolescent or pediatric</td>
<td>08</td>
<td>CVX</td>
<td>08</td>
<td>CVX</td>
<td>Hep B, adolescent or pediatric</td>
<td>136.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0d016955-26db-966c-3d52-26d441bfcb97</td>
<td>999-47-8500</td>
<td>Ms.</td>
<td>Tracy345</td>
<td>Smith67</td>
<td>2000-07-17</td>
<td>410620009</td>
<td>SNOMED</td>
<td>39c15c0f-5c49-311e-99d2-1fb99d80e06e</td>
<td>HARBOR HEALTH SERVICES INC</td>
<td>...</td>
<td>Well child visit (procedure)</td>
<td>2014-08-18T14:52:06+02:00</td>
<td>2014-08-18T15:07:06+02:00</td>
<td>Influenza, seasonal, injectable, preservative ...</td>
<td>140</td>
<td>CVX</td>
<td>140</td>
<td>CVX</td>
<td>Influenza, seasonal, injectable, preservative ...</td>
<td>136.0</td>
</tr>
</tbody>
</table>

<p>5 rows × 22 columns</p>
</div>
</div>
</div>
</div>
<div id="tabset-10-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-4-tab">
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>df_joined_ibis <span class="op">=</span> df_timeline_IBIS.left_join(</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>    df_price_list_ibis, [</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>        df_timeline_IBIS.vaccine_code <span class="op">==</span> df_price_list_ibis.code,</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>        df_timeline_IBIS.vaccine_code_system <span class="op">==</span> df_price_list_ibis.system</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>).to_pandas()</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>df_joined_ibis.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">patient_id</th>
<th data-quarto-table-cell-role="th">social_security_number</th>
<th data-quarto-table-cell-role="th">prefix</th>
<th data-quarto-table-cell-role="th">first_name</th>
<th data-quarto-table-cell-role="th">last_name</th>
<th data-quarto-table-cell-role="th">birthDate</th>
<th data-quarto-table-cell-role="th">code</th>
<th data-quarto-table-cell-role="th">system</th>
<th data-quarto-table-cell-role="th">organization_id</th>
<th data-quarto-table-cell-role="th">organization_name</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">procedure_name</th>
<th data-quarto-table-cell-role="th">start_time</th>
<th data-quarto-table-cell-role="th">end_time</th>
<th data-quarto-table-cell-role="th">Vaccine_name</th>
<th data-quarto-table-cell-role="th">vaccine_code</th>
<th data-quarto-table-cell-role="th">vaccine_code_system</th>
<th data-quarto-table-cell-role="th">code_right</th>
<th data-quarto-table-cell-role="th">system_right</th>
<th data-quarto-table-cell-role="th">item_claimed</th>
<th data-quarto-table-cell-role="th">USD</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>4fc244f3-2c0e-4017-d64d-c2c4cd03655f</td>
<td>999-53-5813</td>
<td>Mrs.</td>
<td>Alyce744</td>
<td>Bergstrom287</td>
<td>1965-01-07</td>
<td>162673000</td>
<td>SNOMED</td>
<td>b03b624d-c939-3688-986d-9555b8009a3b</td>
<td>HOLYOKE HEALTH CENTER INC</td>
<td>...</td>
<td>General examination of patient (procedure)</td>
<td>2015-01-08T07:11:47+01:00</td>
<td>2015-01-08T07:26:47+01:00</td>
<td>zoster vaccine, live</td>
<td>121</td>
<td>CVX</td>
<td>121</td>
<td>CVX</td>
<td>zoster vaccine, live</td>
<td>136.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>4fc244f3-2c0e-4017-d64d-c2c4cd03655f</td>
<td>999-53-5813</td>
<td>Mrs.</td>
<td>Alyce744</td>
<td>Bergstrom287</td>
<td>1965-01-07</td>
<td>162673000</td>
<td>SNOMED</td>
<td>b03b624d-c939-3688-986d-9555b8009a3b</td>
<td>HOLYOKE HEALTH CENTER INC</td>
<td>...</td>
<td>General examination of patient (procedure)</td>
<td>2015-01-08T07:11:47+01:00</td>
<td>2015-01-08T07:26:47+01:00</td>
<td>Influenza, seasonal, injectable, preservative ...</td>
<td>140</td>
<td>CVX</td>
<td>140</td>
<td>CVX</td>
<td>Influenza, seasonal, injectable, preservative ...</td>
<td>136.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>fca8d2ca-7aef-2c27-3bba-3f94723012f5</td>
<td>999-24-8599</td>
<td>None</td>
<td>Marlen929</td>
<td>Greenholt190</td>
<td>2016-04-01</td>
<td>410620009</td>
<td>SNOMED</td>
<td>3f12ebb4-e03c-3453-88d2-4fc9682383df</td>
<td>NEW BEDFORD INTERNAL MEDICINE &amp; GERIATRICS, LLC</td>
<td>...</td>
<td>Well child visit (procedure)</td>
<td>2016-04-01T04:09:48+02:00</td>
<td>2016-04-01T04:24:48+02:00</td>
<td>Hep B, adolescent or pediatric</td>
<td>08</td>
<td>CVX</td>
<td>08</td>
<td>CVX</td>
<td>Hep B, adolescent or pediatric</td>
<td>136.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>19936964-a432-d501-2cd5-fa52db6b9f41</td>
<td>999-33-7974</td>
<td>None</td>
<td>Monique148</td>
<td>Haley279</td>
<td>2022-01-07</td>
<td>410620009</td>
<td>SNOMED</td>
<td>c6b019eb-28ec-36f6-abf3-bcc4d1d58966</td>
<td>DUTTON FAMILY CARE ASSOCIATES LLP</td>
<td>...</td>
<td>Well child visit (procedure)</td>
<td>2022-01-07T02:19:02+01:00</td>
<td>2022-01-07T02:34:02+01:00</td>
<td>Hep B, adolescent or pediatric</td>
<td>08</td>
<td>CVX</td>
<td>08</td>
<td>CVX</td>
<td>Hep B, adolescent or pediatric</td>
<td>136.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0d016955-26db-966c-3d52-26d441bfcb97</td>
<td>999-47-8500</td>
<td>Ms.</td>
<td>Tracy345</td>
<td>Smith67</td>
<td>2000-07-17</td>
<td>410620009</td>
<td>SNOMED</td>
<td>39c15c0f-5c49-311e-99d2-1fb99d80e06e</td>
<td>HARBOR HEALTH SERVICES INC</td>
<td>...</td>
<td>Well child visit (procedure)</td>
<td>2014-08-18T14:52:06+02:00</td>
<td>2014-08-18T15:07:06+02:00</td>
<td>Influenza, seasonal, injectable, preservative ...</td>
<td>140</td>
<td>CVX</td>
<td>140</td>
<td>CVX</td>
<td>Influenza, seasonal, injectable, preservative ...</td>
<td>136.0</td>
</tr>
</tbody>
</table>

<p>5 rows × 22 columns</p>
</div>
</div>
</div>
</div>
<div id="tabset-10-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-5-tab">
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>df_joined_pyspark <span class="op">=</span> df_timeline_spark.join(df_price_list_spark,(df_timeline_spark[<span class="st">'vaccine_code'</span>] <span class="op">==</span> df_price_list_spark[<span class="st">'code'</span>]) <span class="op">&amp;</span> (df_timeline_spark[<span class="st">'vaccine_code_system'</span>] <span class="op">==</span> df_price_list_spark[<span class="st">'system'</span>]),<span class="st">'inner'</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>df_joined_pyspark.limit(<span class="dv">5</span>).show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------------+----------------------+------+----------+------------+-------------------+---------+------+--------------------+--------------------+--------------------+---------------+--------------------+-------------------+--------------------+--------------------+------------+-------------------+----+----+------+--------------------+-----+
|          patient_id|social_security_number|prefix|first_name|   last_name|          birthDate|     code|system|     organization_id|   organization_name|   practitioner_name|practitioner_id|      procedure_name|         start_time|            end_time|        Vaccine_name|vaccine_code|vaccine_code_system|year|code|system|        item_claimed|  USD|
+--------------------+----------------------+------+----------+------------+-------------------+---------+------+--------------------+--------------------+--------------------+---------------+--------------------+-------------------+--------------------+--------------------+------------+-------------------+----+----+------+--------------------+-----+
|4fc244f3-2c0e-401...|           999-53-5813|  Mrs.|  Alyce744|Bergstrom287|1965-01-07 00:00:00|162673000|SNOMED|b03b624d-c939-368...|HOLYOKE HEALTH CE...|Dr. Bennett146 Ha...|     9999981894|General examinati...|2015-01-08 05:11:47|2015-01-08T07:26:...|zoster vaccine, live|         121|                CVX|2015| 121|   CVX|zoster vaccine, live|136.0|
|4fc244f3-2c0e-401...|           999-53-5813|  Mrs.|  Alyce744|Bergstrom287|1965-01-07 00:00:00|162673000|SNOMED|b03b624d-c939-368...|HOLYOKE HEALTH CE...|Dr. Bennett146 Ha...|     9999981894|General examinati...|2015-01-08 05:11:47|2015-01-08T07:26:...|Influenza, season...|         140|                CVX|2015| 140|   CVX|Influenza, season...|136.0|
|fca8d2ca-7aef-2c2...|           999-24-8599|  NULL| Marlen929|Greenholt190|2016-04-01 00:00:00|410620009|SNOMED|3f12ebb4-e03c-345...|NEW BEDFORD INTER...|Dr. Homero668 Rol...|     9999962894|Well child visit ...|2016-04-01 00:09:48|2016-04-01T04:24:...|Hep B, adolescent...|          08|                CVX|2016|  08|   CVX|Hep B, adolescent...|136.0|
|19936964-a432-d50...|           999-33-7974|  NULL|Monique148|    Haley279|2022-01-07 00:00:00|410620009|SNOMED|c6b019eb-28ec-36f...|DUTTON FAMILY CAR...|Dr. Maren639 Aufd...|     9999950790|Well child visit ...|2022-01-07 00:19:02|2022-01-07T02:34:...|Hep B, adolescent...|          08|                CVX|2022|  08|   CVX|Hep B, adolescent...|136.0|
|0d016955-26db-966...|           999-47-8500|   Ms.|  Tracy345|     Smith67|2000-07-17 00:00:00|410620009|SNOMED|39c15c0f-5c49-311...|HARBOR HEALTH SER...|Dr. Salvador46 Ho...|     9999977496|Well child visit ...|2014-08-18 10:52:06|2014-08-18T15:07:...|Influenza, season...|         140|                CVX|2014| 140|   CVX|Influenza, season...|136.0|
+--------------------+----------------------+------+----------+------------+-------------------+---------+------+--------------------+--------------------+--------------------+---------------+--------------------+-------------------+--------------------+--------------------+------------+-------------------+----+----+------+--------------------+-----+
</code></pre>
</div>
</div>
</div>
<div id="tabset-10-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-6-tab">
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>df_joined <span class="op">&lt;-</span> df <span class="op">%&gt;%</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  left_join(</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>    df_price_list,</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    by <span class="op">=</span> c(<span class="st">"vaccine_code"</span> <span class="op">=</span> <span class="st">"code"</span>, <span class="st">"vaccine_code_system"</span> <span class="op">=</span> <span class="st">"system"</span>)</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>kable(head(df_joined))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

|patient_id                           |social_security_number |prefix |first_name |last_name    |birthDate  |      code|system |organization_id                      |organization_name                               |practitioner_name          |practitioner_id |procedure_name                             |start_time                |end_time                  |Vaccine_name                                       |vaccine_code |vaccine_code_system |item_claimed                                       | USD|
|:------------------------------------|:----------------------|:------|:----------|:------------|:----------|---------:|:------|:------------------------------------|:-----------------------------------------------|:--------------------------|:---------------|:------------------------------------------|:-------------------------|:-------------------------|:--------------------------------------------------|:------------|:-------------------|:--------------------------------------------------|---:|
|4fc244f3-2c0e-4017-d64d-c2c4cd03655f |999-53-5813            |Mrs.   |Alyce744   |Bergstrom287 |1965-01-07 | 162673000|SNOMED |b03b624d-c939-3688-986d-9555b8009a3b |HOLYOKE HEALTH CENTER INC                       |Dr. Bennett146 Hartmann983 |9999981894      |General examination of patient (procedure) |2015-01-08T07:11:47+01:00 |2015-01-08T07:26:47+01:00 |zoster vaccine, live                               |121          |CVX                 |zoster vaccine, live                               | 136|
|4fc244f3-2c0e-4017-d64d-c2c4cd03655f |999-53-5813            |Mrs.   |Alyce744   |Bergstrom287 |1965-01-07 | 162673000|SNOMED |b03b624d-c939-3688-986d-9555b8009a3b |HOLYOKE HEALTH CENTER INC                       |Dr. Bennett146 Hartmann983 |9999981894      |General examination of patient (procedure) |2015-01-08T07:11:47+01:00 |2015-01-08T07:26:47+01:00 |Influenza, seasonal, injectable, preservative free |140          |CVX                 |Influenza, seasonal, injectable, preservative free | 136|
|fca8d2ca-7aef-2c27-3bba-3f94723012f5 |999-24-8599            |NA     |Marlen929  |Greenholt190 |2016-04-01 | 410620009|SNOMED |3f12ebb4-e03c-3453-88d2-4fc9682383df |NEW BEDFORD INTERNAL MEDICINE &amp; GERIATRICS, LLC |Dr. Homero668 Rolón954     |9999962894      |Well child visit (procedure)               |2016-04-01T04:09:48+02:00 |2016-04-01T04:24:48+02:00 |Hep B, adolescent or pediatric                     |08           |CVX                 |Hep B, adolescent or pediatric                     | 136|
|19936964-a432-d501-2cd5-fa52db6b9f41 |999-33-7974            |NA     |Monique148 |Haley279     |2022-01-07 | 410620009|SNOMED |c6b019eb-28ec-36f6-abf3-bcc4d1d58966 |DUTTON FAMILY CARE ASSOCIATES LLP               |Dr. Maren639 Aufderhar910  |9999950790      |Well child visit (procedure)               |2022-01-07T02:19:02+01:00 |2022-01-07T02:34:02+01:00 |Hep B, adolescent or pediatric                     |08           |CVX                 |Hep B, adolescent or pediatric                     | 136|
|0d016955-26db-966c-3d52-26d441bfcb97 |999-47-8500            |Ms.    |Tracy345   |Smith67      |2000-07-17 | 410620009|SNOMED |39c15c0f-5c49-311e-99d2-1fb99d80e06e |HARBOR HEALTH SERVICES INC                      |Dr. Salvador46 Homenick806 |9999977496      |Well child visit (procedure)               |2014-08-18T14:52:06+02:00 |2014-08-18T15:07:06+02:00 |Influenza, seasonal, injectable, preservative free |140          |CVX                 |Influenza, seasonal, injectable, preservative free | 136|
|3a2311a7-eb30-2aae-59c0-55ae273d1581 |999-40-6084            |NA     |Janene3    |Howe413      |2016-11-01 | 410620009|SNOMED |2e8b42f8-4300-30a9-a576-d513d1021a0a |GREATER LOWELL FAMILY PRACTICE PC               |Dr. Homero668 Salcedo309   |9999959890      |Well child visit (procedure)               |2016-11-01T04:38:02+01:00 |2016-11-01T04:53:02+01:00 |Hep B, adolescent or pediatric                     |08           |CVX                 |Hep B, adolescent or pediatric                     | 136|</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="finishing-up" class="level3">
<h3 class="anchored" data-anchor-id="finishing-up">Finishing up</h3>
<p>When using duckdb it is very important to always close the database connection. If one is connected to the databas a wall is created to block anyone else from connecting at the same time. This prevents conflicts when more are manipulating the data at the same time.</p>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co">#close connection to the duckdb database</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>con_duckdb.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../src/duckdb.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Create views using DuckDB</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">© PharmAccess Foundation, 2023.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>